<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1"><title>GCE에서 kops를 이용한 K8s 구성 - ShrinkLabs</title>
<meta property="og:title" content="GCE에서 kops를 이용한 K8s 구성 - ShrinkLabs">
<meta property="og:type" content="article">


<meta property="og:image" content="images/logo.png">

<meta property="og:url" content="https://shrinklabs.com/post/container_k8s-with-kops-on-gce/">


<meta property="keywords" content ="gcp, kubernetes">

<link rel="stylesheet" href="https://shrinklabs.com/css/style.min.css">

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<meta name="theme-color" content="#ffffff">
<link rel="webmention" href="https://webmention.io/hugocisneros.com/webmention">
<link rel="pingback" href="https://webmention.io/hugocisneros.com/xmlrpc">
<script>
 function updateMode() {
    
    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark');
    }
 }
 function toggleMode() {
     if (localStorage.theme === 'dark') {
        
        localStorage.theme = 'light';
     }
     else {
        
        localStorage.theme = 'dark';
     }
     updateMode()
 }
 window.onload = updateMode();
 function toggleMenu() {
     let navbar = document.getElementById("navbar-default");
     if (navbar.classList.contains("hidden")) {
        navbar.classList.remove("hidden");
     }
     else {
        navbar.classList.add("hidden");
     }
 }
</script>

  </head>
  <body>
    <header class="md:px-0 px-2">
        <nav >
  <div class="container flex flex-wrap justify-between items-center mx-auto">
    <div class="nav-main my-2.5">
      <a href="https://shrinklabs.com/" class="nav-title py-2.5 text-2xl text-zinc-600 dark:text-zinc-300 hover:border-b-0">ShrinkLabs</a>
    </div>
    <button type="button"
            onclick="toggleMenu()"
            class="inline-flex items-center p-2 ml-3
                  text-sm text-gray-500
                  rounded-lg md:hidden hover:bg-gray-100
                  focus:outline-none focus:ring-2
                  focus:ring-gray-200 dark:text-gray-400
                  dark:hover:bg-gray-700 dark:focus:ring-gray-600"
            aria-controls="navbar-default"
            aria-expanded="false">
        <span class="sr-only">Open main menu</span>
        <svg class="w-6 h-6" aria-hidden="true" fill="currentColor"
             viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1
                           0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0
                           01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0
                           01-1-1z" clip-rule="evenodd"></path>
        </svg>
    </button>
    <div class="hidden w-full md:block md:w-auto" id="navbar-default">
      <ul class="grid md:grid-flow-col items-center justify-between text-lg my-2.5">
        
        <li class="p-2.5 md:first:pl-0 md:border-none border-b list-none">
          <a class="text-zinc-600 dark:text-zinc-300
                    hover:border-b-0" href="/post/">posts</a>
        </li>
        
        <li class="p-2.5 md:first:pl-0 md:border-none border-b list-none">
          <a class="text-zinc-600 dark:text-zinc-300
                    hover:border-b-0" href="/categories/">categories</a>
        </li>
        
        <li class="p-2.5 md:first:pl-0 md:border-none border-b list-none">
          <a class="text-zinc-600 dark:text-zinc-300
                    hover:border-b-0" href="/tags/">tags</a>
        </li>
        
        <li class="p-2.5 md:first:pl-0 md:border-none border-b list-none">
          <a class="text-zinc-600 dark:text-zinc-300
                    hover:border-b-0" href="/contact/">contact</a>
        </li>
        
        <li class="h-7 pl-2.5 pr-0 list-none">
          <button type="button" onclick="toggleMode()" class="h-full">
            <img class="h-7 w-7 max-h-full mb-1.5 p-1.5 hidden dark:inline" id="dark-mode-button-img"
                 src="https://shrinklabs.com/img/light_mode.svg">
            <img class="h-7 w-7 max-h-full mb-1.5 p-1.5 inline dark:hidden" id="dark-mode-button-img"
                 src="https://shrinklabs.com/img/dark_mode.svg">
          </button>
        </li>
      </ul>
    </div>
  </div>
</nav>


    </header>
    <main class="content h-card container mt-2 m-auto
                 leading-loose md:px-0 px-2 z-0 Page(/post/container_k8s-with-kops-on-gce.md)"
          role="main">
    
    <article class="article" itemprop="mainEntity" itemscope itemtype="http://schema.org/BlogPosting">
    <div class="title-container">
    <h1 class="article-title" itemprop="name">GCE에서 kops를 이용한 K8s 구성</h1>
    
    <div class="article-subtitle">
    
    <span class="article-date" itemprop="datePublished" content="2020-03-05T21:36:13&#43;0900">2020-03-05</span>
    
    
    
    <span class="article-author" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jaehoon Khim</span></span>
    
    
    </div>
    
    </div>

    <div class="article-content" itemprop="articleBody">
      <h1 id="클러스터-배포용-vm-인스턴스-생성">클러스터 배포용 VM 인스턴스 생성</h1>
<ul>
<li>Kubernetes를 구성하기 위한 VM 인스턴스를 생성합니다.</li>
<li>&ldquo;ID 및 API 액세스&rdquo; 항목에서 액세스 범위를 &ldquo;모든 Cloud API에 대한 전체 액세스 허용&rdquo; 으로 선택한다. 또는 아래와 같이 서비스 계정에 권한을 설정하고 서비스 계정을 선택해도 됩니다.
<ul>
<li>GCP 관리 콘솔의 IAM&amp;Admin에서 서비스 계정을 하나 만듭니다. 서비스 계정이 갖고 있어야 하는 최소한의 권한은 다음과 같습니다.</li>
</ul>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">compute admin
servce account admin
service account key admin
service account token creator
service acount user
storage admin
DNS Administrator
DNS Reader
</code></pre></div><ul>
<li>SSH로 연결 &amp; 업데이트</li>
</ul>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~<span style="color:#40ffff">$sudo</span> apt-get update
jaehoonn@jaehoonn:~<span style="color:#40ffff">$sudo</span> apt-get dist-upgrade
</code></pre></div></li>
</ul>
<h1 id="kubectl-설치">kubectl 설치</h1>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~<span style="color:#40ffff">$curl</span> -LO https://storage.googleapis.com/kubernetes-release/release/<span style="color:#6ab825;font-weight:bold">$(</span>curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt<span style="color:#6ab825;font-weight:bold">)</span>/bin/linux/amd64/kubectl
jaehoonn@jaehoonn:~<span style="color:#40ffff">$chmod</span> +x ./kubectl
jaehoonn@jaehoonn:~<span style="color:#40ffff">$sudo</span> mv ./kubectl /usr/local/bin/kubectl
</code></pre></div><h1 id="kops-설치">kops 설치</h1>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~<span style="color:#40ffff">$wget</span> -O kops https://github.com/kubernetes/kops/releases/download/<span style="color:#6ab825;font-weight:bold">$(</span>curl -s https://api.github.com/repos/kubernetes/kops/releases/latest | grep tag_name | cut -d <span style="color:#ed9d13">&#39;&#34;&#39;</span> -f 4<span style="color:#6ab825;font-weight:bold">)</span>/kops-linux-amd64
jaehoonn@jaehoonn:~<span style="color:#40ffff">$chmod</span> +x ./kops
jaehoonn@jaehoonn:~<span style="color:#40ffff">$sudo</span> mv ./kops /usr/local/bin/
</code></pre></div><h1 id="gcp-tool-설치">GCP Tool 설치</h1>
<ul>
<li><a href="https://cloud.google.com/sdk/install">https://cloud.google.com/sdk/install</a></li>
</ul>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~<span style="color:#40ffff">$export</span> <span style="color:#40ffff">CLOUD_SDK_REPO</span>=<span style="color:#ed9d13">&#34;cloud-sdk-</span><span style="color:#6ab825;font-weight:bold">$(</span>lsb_release -c -s<span style="color:#6ab825;font-weight:bold">)</span><span style="color:#ed9d13">&#34;</span>
jaehoonn@jaehoonn:~<span style="color:#40ffff">$echo</span> <span style="color:#ed9d13">&#34;deb http://packages.cloud.google.com/apt </span><span style="color:#40ffff">$CLOUD_SDK_REPO</span><span style="color:#ed9d13"> main&#34;</span> | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
jaehoonn@jaehoonn:~<span style="color:#40ffff">$sudo</span> apt-get install apt-transport-https ca-certificates
jaehoonn@jaehoonn:~<span style="color:#40ffff">$curl</span> https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
jaehoonn@jaehoonn:~<span style="color:#40ffff">$sudo</span> apt-get update &amp;&amp; sudo apt-get install google-cloud-sdk
</code></pre></div><ul>
<li>추가 구성요소는 선택적으로 설치 합니다. ( sudo apt-get install )</li>
</ul>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">google-cloud-sdk-app-engine-python
google-cloud-sdk-app-engine-python-extras
google-cloud-sdk-app-engine-java
google-cloud-sdk-app-engine-go
google-cloud-sdk-datalab
google-cloud-sdk-datastore-emulator
google-cloud-sdk-pubsub-emulator
google-cloud-sdk-cbt
google-cloud-sdk-cloud-build-local
google-cloud-sdk-bigtable-emulator
kubectl
</code></pre></div><ul>
<li>GCP를 시작하기 위한 초기화</li>
</ul>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~<span style="color:#40ffff">$gcloud</span> init
Welcome! This <span style="color:#24909d">command</span> will take you through the configuration of gcloud.
Your current configuration has been <span style="color:#24909d">set</span> to: [default]
You can skip diagnostics next <span style="color:#24909d">time</span> by using the following flag:
  gcloud init --skip-diagnostics
Network diagnostic detects and fixes <span style="color:#24909d">local</span> network connection issues.
Checking network connection...done.                                                                                
Reachability Check passed.
Network diagnostic passed (1/1 checks passed).
Choose the account you would like to use to perform operations <span style="color:#6ab825;font-weight:bold">for</span> 
this configuration:
 [1] xxxxxxxxxxxx-compute@developer.gserviceaccount.com
 [2] Log in with a new account
Please enter your numeric choice: <span style="color:#3677a9">1</span>

You are logged in as: [xxxxxxxxxxxx-compute@developer.gserviceaccount.com].
Pick cloud project to use: 
 [1] jaehoonn-000000
 [2] Create a new project
Please enter numeric choice or text value (must exactly match list 
item): <span style="color:#3677a9">1</span>

Your current project has been <span style="color:#24909d">set</span> to: [jaehoonn-000000].

Do you want to configure a default Compute Region and Zone? (Y/n)? y

Which Google Compute Engine zone would you like to use as project 
default?
If you <span style="color:#6ab825;font-weight:bold">do</span> not specify a zone via a <span style="color:#24909d">command</span> line flag <span style="color:#6ab825;font-weight:bold">while</span> working 
with Compute Engine resources, the default is assumed.
 [1] us-east1-b
 [2] us-east1-c
 [3] us-east1-d
 [4] us-east4-c
 [5] us-east4-b
 [6] us-east4-a
 [7] us-central1-c
 [8] us-central1-a
 [9] us-central1-f
 [10] us-central1-b
 [11] us-west1-b
 [12] us-west1-c
 [13] us-west1-a
 [14] europe-west4-a
 [15] europe-west4-b
 [16] europe-west4-c
 [17] europe-west1-b
 [18] europe-west1-d
 [19] europe-west1-c
 [20] europe-west3-c
 [21] europe-west3-a
 [22] europe-west3-b
 [23] europe-west2-c
 [24] europe-west2-b
 [25] europe-west2-a
 [26] asia-east1-b
 [27] asia-east1-a
 [28] asia-east1-c
 [29] asia-southeast1-b
 [30] asia-southeast1-a
 [31] asia-southeast1-c
 [32] asia-northeast1-b
 [33] asia-northeast1-c
 [34] asia-northeast1-a
 [35] asia-south1-c
 [36] asia-south1-b
 [37] asia-south1-af
 [38] australia-southeast1-b
 [39] australia-southeast1-c
 [40] australia-southeast1-a
 [41] southamerica-east1-b
 [42] southamerica-east1-c
 [43] southamerica-east1-a
 [44] asia-east2-a
 [45] asia-east2-b
 [46] asia-east2-c
 [47] asia-northeast2-a
 [48] asia-northeast2-b
 [49] asia-northeast2-c
 [50] europe-north1-a
Did not print [12] options.
Too many options [62]. Enter <span style="color:#ed9d13">&#34;list&#34;</span> at prompt to print choices fully.
Please enter numeric choice or text value (must exactly match list 
item): <span style="color:#3677a9">8</span>

Your project default Compute Engine zone has been <span style="color:#24909d">set</span> to [us-central1-a].
You can change it by running [gcloud config <span style="color:#24909d">set</span> compute/zone NAME].
Your project default Compute Engine region has been <span style="color:#24909d">set</span> to [us-central1].
You can change it by running [gcloud config <span style="color:#24909d">set</span> compute/region NAME].
Created a default .boto configuration file at [/home/jaehoonn/.boto]. See this file and
[https://cloud.google.com/storage/docs/gsutil/commands/config] <span style="color:#6ab825;font-weight:bold">for</span> more
information about configuring Google Cloud Storage.
Your Google Cloud SDK is configured and ready to use!
* Commands that require authentication will use xxxxxxxxxxxx-compute@developer.gserviceaccount.com by default
* Commands will reference project <span style="color:#ed9d13">`</span>jaehoonn-000000<span style="color:#ed9d13">`</span> by default
* Compute Engine commands will use region <span style="color:#ed9d13">`</span>us-central1<span style="color:#ed9d13">`</span> by default
* Compute Engine commands will use zone <span style="color:#ed9d13">`</span>us-central1-a<span style="color:#ed9d13">`</span> by default
Run <span style="color:#ed9d13">`</span>gcloud <span style="color:#24909d">help</span> config<span style="color:#ed9d13">`</span> to learn how to change individual settings
This gcloud configuration is called [default]. You can create additional configurations <span style="color:#6ab825;font-weight:bold">if</span> you work with multiple accounts and/or projects.
Run <span style="color:#ed9d13">`</span>gcloud topic configurations<span style="color:#ed9d13">`</span> to learn more.
Some things to try next:
* Run <span style="color:#ed9d13">`</span>gcloud --help<span style="color:#ed9d13">`</span> to see the Cloud Platform services you can interact with. And run <span style="color:#ed9d13">`</span>gcloud <span style="color:#24909d">help</span> COMMAND<span style="color:#ed9d13">`</span> to get <span style="color:#24909d">help</span> on any gcloud command.
* Run <span style="color:#ed9d13">`</span>gcloud topic --help<span style="color:#ed9d13">`</span> to learn about advanced features of the SDK like arg files and output formatting
jaehoonn@jaehoonn:~$
</code></pre></div><ul>
<li>선택 사항
<ul>
<li>&ldquo;Please enter your numeric choice: 1&rdquo;
<ul>
<li>연결되어 있는 서비스 계정인 &ldquo;[1] <a href="mailto:xxxxxxxxxxxx-compute@developer.gserviceaccount.com">xxxxxxxxxxxx-compute@developer.gserviceaccount.com</a>&rdquo; 를 선택</li>
</ul>
</li>
<li>&ldquo;Please enter numeric choice or text value (must exactly match list
item): 1&rdquo;
<ul>
<li>연결하고자 하는 프로젝트인 &ldquo;[1] jaehoonn-000000&rdquo; 를 선택</li>
</ul>
</li>
<li>&ldquo;Do you want to configure a default Compute Region and Zone? (Y/n)? y&rdquo;
<ul>
<li>기본으로 제공되고 있는 region과 zone을 사용</li>
</ul>
</li>
<li>&ldquo;Please enter numeric choice or text value (must exactly match list
item): 8&rdquo;</li>
</ul>
</li>
</ul>
<h1 id="스토리지버킷-생성">스토리지(버킷) 생성</h1>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$ gsutil mb gs://jaehoonn-cluster-state-store
Creating gs://jaehoonn-cluster-state-store/...
jaehoonn@jaehoonn:~$ <span style="color:#24909d">export</span> <span style="color:#40ffff">KOPS_STATE_STORE</span>=gs://jaehoonn-cluster-state-store/
</code></pre></div><ul>
<li>kops는 클러스터 구성을 유지하기 위한 상태 저장소로서 &ldquo;Storage&quot;의 &ldquo;Bucket&quot;을 이용합니다.
<ul>
<li>mb: Make buckets</li>
</ul>
</li>
<li>Bucket의 이름은 필요한 형태로 만들면 됩니다. (ex, jaehoonn-cluster-state-store)</li>
</ul>
<h1 id="클러스터-생성">클러스터 생성</h1>
<ul>
<li>Google Cloud에서 사용할 정보</li>
</ul>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$ <span style="color:#40ffff">PROJECT</span>=<span style="color:#ed9d13">`</span>gcloud config get-value project<span style="color:#ed9d13">`</span>
jaehoonn@jaehoonn:~$ <span style="color:#24909d">export</span> <span style="color:#40ffff">KOPS_FEATURE_FLAGS</span>=AlphaAllowGCE <span style="color:#999;font-style:italic"># to unlock the GCE features</span>
</code></pre></div><ul>
<li>Kubernetes 클러스터 생성(상태 저장소)</li>
</ul>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$ kops create cluster --name=jaehoonn-cluster.k8s.local --zones=us-central1-a --state=<span style="color:#ed9d13">${</span><span style="color:#40ffff">KOPS_STATE_STORE</span><span style="color:#ed9d13">}</span> --project=<span style="color:#ed9d13">${</span><span style="color:#40ffff">PROJECT</span><span style="color:#ed9d13">}</span>

ManagedFile/jaehoonn-cluster.k8s.local-addons-dns-controller.addons.k8s.io-k8s-1.6
        Location                addons/dns-controller.addons.k8s.io/k8s-1.6.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-dns-controller.addons.k8s.io-pre-k8s-1.6
        Location                addons/dns-controller.addons.k8s.io/pre-k8s-1.6.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-kube-dns.addons.k8s.io-k8s-1.12
        Location                addons/kube-dns.addons.k8s.io/k8s-1.12.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-kube-dns.addons.k8s.io-k8s-1.6
        Location                addons/kube-dns.addons.k8s.io/k8s-1.6.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-kube-dns.addons.k8s.io-pre-k8s-1.6
        Location                addons/kube-dns.addons.k8s.io/pre-k8s-1.6.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-kubelet-api.rbac.addons.k8s.io-k8s-1.9
        Location                addons/kubelet-api.rbac.addons.k8s.io/k8s-1.9.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-limit-range.addons.k8s.io
        Location                addons/limit-range.addons.k8s.io/v1.5.0.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-rbac.addons.k8s.io-k8s-1.8
        Location                addons/rbac.addons.k8s.io/k8s-1.8.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-storage-gce.addons.k8s.io-v1.6.0
        Location                addons/storage-gce.addons.k8s.io/v1.6.0.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-storage-gce.addons.k8s.io-v1.7.0
        Location                addons/storage-gce.addons.k8s.io/v1.7.0.yaml

  ManagedFile/etcd-cluster-spec-events
        Location                backups/etcd/events/control/etcd-cluster-spec

  ManagedFile/etcd-cluster-spec-main
        Location                backups/etcd/main/control/etcd-cluster-spec

  ManagedFile/manifests-etcdmanager-events
        Location                manifests/etcd/events.yaml

  ManagedFile/manifests-etcdmanager-main
        Location                manifests/etcd/main.yaml

  Secret/admin

  Secret/kube

  Secret/kube-proxy

  Secret/kubelet

  Secret/system:controller_manager

  Secret/system:dns

  Secret/system:logging

  Secret/system:monitoring

  Secret/system:scheduler

  StorageBucketAcl/serviceaccount-backup-readwrite-jaehoonn-cluster-state-store
        Bucket                  jaehoonn-cluster-state-store
        Entity                  xxxx-000000000000-compute@developer.gserviceaccount.com
        Role                    WRITER

  TargetPool/api-jaehoonn-cluster-k8s-local

Must specify --yes to apply changes

Cluster configuration has been created.

Suggestions:
 * list clusters with: kops get cluster
 * edit this cluster with: kops edit cluster jaehoonn-cluster.k8s.local
 * edit your node instance group: kops edit ig --name=jaehoonn-cluster.k8s.local nodes
 * edit your master instance group: kops edit ig --name=jaehoonn-cluster.k8s.local master-us-central1-a

Finally configure your cluster with: kops update cluster --name jaehoonn-cluster.k8s.local --yes

jaehoonn@jaehoonn:~$
</code></pre></div><ul>
<li>Kubernetes 클러스터 생성(VM 인스턴스에 직접 생성)</li>
</ul>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$ kops update cluster --name jaehoonn-cluster.k8s.local --yes
I1106 05:42:52.576477   <span style="color:#3677a9">26628</span> apply_cluster.go:559] Gossip DNS: skipping DNS validation
W1106 05:42:52.641383   <span style="color:#3677a9">26628</span> external_access.go:36] TODO: Harmonize gcemodel ExternalAccessModelBuilder with awsmodel
W1106 05:42:52.641597   <span style="color:#3677a9">26628</span> firewall.go:35] TODO: Harmonize gcemodel with awsmodel <span style="color:#6ab825;font-weight:bold">for</span> firewall - GCE model is way too open
W1106 05:42:52.641685   <span style="color:#3677a9">26628</span> firewall.go:63] Adding overlay network <span style="color:#6ab825;font-weight:bold">for</span> X -&gt; node rule - HACK
W1106 05:42:52.641750   <span style="color:#3677a9">26628</span> firewall.go:64] We should probably use subnets?
W1106 05:42:52.641824   <span style="color:#3677a9">26628</span> firewall.go:118] Adding overlay network <span style="color:#6ab825;font-weight:bold">for</span> X -&gt; master rule - HACK
W1106 05:42:52.770317   <span style="color:#3677a9">26628</span> storageacl.go:71] we need to split master / node roles
W1106 05:42:52.770353   <span style="color:#3677a9">26628</span> storageacl.go:86] adding bucket level write ACL to gs://jaehoonn-cluster-state-store to support etcd backup
W1106 05:42:52.770450   <span style="color:#3677a9">26628</span> autoscalinggroup.go:108] enabling storage-rw <span style="color:#6ab825;font-weight:bold">for</span> etcd backups
I1106 05:42:54.889249   <span style="color:#3677a9">26628</span> executor.go:103] Tasks: <span style="color:#3677a9">0</span> <span style="color:#6ab825;font-weight:bold">done</span> / <span style="color:#3677a9">66</span> total; <span style="color:#3677a9">39</span> can run
I1106 05:42:55.253887   <span style="color:#3677a9">26628</span> address.go:123] GCE creating address: <span style="color:#ed9d13">&#34;api-jaehoonn-cluster-k8s-local&#34;</span>
I1106 05:42:55.387139   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;etcd-peers-ca-events&#34;</span>
I1106 05:42:55.672462   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;apiserver-aggregator-ca&#34;</span>
I1106 05:42:55.765508   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;etcd-manager-ca-main&#34;</span>
I1106 05:42:55.985020   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;etcd-peers-ca-main&#34;</span>
I1106 05:42:56.327905   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;etcd-clients-ca&#34;</span>
I1106 05:42:56.593223   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;ca&#34;</span>
I1106 05:42:56.803652   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;etcd-manager-ca-events&#34;</span>
I1106 05:43:08.063339   <span style="color:#3677a9">26628</span> executor.go:103] Tasks: <span style="color:#3677a9">39</span> <span style="color:#6ab825;font-weight:bold">done</span> / <span style="color:#3677a9">66</span> total; <span style="color:#3677a9">25</span> can run
I1106 05:43:08.238400   <span style="color:#3677a9">26628</span> instancetemplate.go:214] We should be using NVME <span style="color:#6ab825;font-weight:bold">for</span> GCE
I1106 05:43:08.240753   <span style="color:#3677a9">26628</span> instancetemplate.go:214] We should be using NVME <span style="color:#6ab825;font-weight:bold">for</span> GCE
I1106 05:43:08.248537   <span style="color:#3677a9">26628</span> instancetemplate.go:214] We should be using NVME <span style="color:#6ab825;font-weight:bold">for</span> GCE
I1106 05:43:08.249786   <span style="color:#3677a9">26628</span> instancetemplate.go:214] We should be using NVME <span style="color:#6ab825;font-weight:bold">for</span> GCE
I1106 05:43:10.777593   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;kube-controller-manager&#34;</span>
I1106 05:43:11.412793   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;kube-scheduler&#34;</span>
I1106 05:43:11.665669   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;apiserver-proxy-client&#34;</span>
I1106 05:43:11.698639   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;apiserver-aggregator&#34;</span>
I1106 05:43:12.071948   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;kubelet-api&#34;</span>
I1106 05:43:12.189613   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;kubelet&#34;</span>
I1106 05:43:12.465094   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;kops&#34;</span>
I1106 05:43:12.539693   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;master&#34;</span>
I1106 05:43:12.633503   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;kube-proxy&#34;</span>
I1106 05:43:12.812512   <span style="color:#3677a9">26628</span> vfs_castore.go:729] Issuing new certificate: <span style="color:#ed9d13">&#34;kubecfg&#34;</span>
I1106 05:43:21.263578   <span style="color:#3677a9">26628</span> executor.go:103] Tasks: <span style="color:#3677a9">64</span> <span style="color:#6ab825;font-weight:bold">done</span> / <span style="color:#3677a9">66</span> total; <span style="color:#3677a9">2</span> can run
I1106 05:43:32.802331   <span style="color:#3677a9">26628</span> executor.go:103] Tasks: <span style="color:#3677a9">66</span> <span style="color:#6ab825;font-weight:bold">done</span> / <span style="color:#3677a9">66</span> total; <span style="color:#3677a9">0</span> can run
I1106 05:43:33.070437   <span style="color:#3677a9">26628</span> update_cluster.go:294] Exporting kubecfg <span style="color:#6ab825;font-weight:bold">for</span> cluster
kops has <span style="color:#24909d">set</span> your kubectl context to jaehoonn-cluster.k8s.local

Cluster is starting.  It should be ready in a few minutes.

Suggestions:
 * validate cluster: kops validate cluster
 * list nodes: kubectl get nodes --show-labels
 * ssh to the master: ssh -i ~/.ssh/id_rsa admin@api.jaehoonn-cluster.k8s.local
 * the admin user is specific to Debian. If not using Debian please use the appropriate user based on your OS.
 * <span style="color:#24909d">read</span> about installing addons at: https://github.com/kubernetes/kops/blob/master/docs/addons.md.

jaehoonn@jaehoonn:~$
</code></pre></div><ul>
<li>클러스터 상태 확인(클러스터 생성 완료되고 5~10분뒤에 확인)</li>
</ul>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$ kops validate cluster
Using cluster from kubectl context: jaehoonn-cluster.k8s.local

Validating cluster jaehoonn-cluster.k8s.local

I1106 05:50:12.213436   <span style="color:#3677a9">26733</span> gce_cloud.go:273] Scanning zones: [us-central1-c us-central1-a us-central1-f us-central1-b]
INSTANCE GROUPS
NAME                    ROLE    MACHINETYPE     MIN     MAX     SUBNETS
master-us-central1-a    Master  n1-standard-1   <span style="color:#3677a9">1</span>       <span style="color:#3677a9">1</span>       us-central1
nodes                   Node    n1-standard-2   <span style="color:#3677a9">2</span>       <span style="color:#3677a9">2</span>       us-central1

NODE STATUS
NAME                            ROLE    READY
master-us-central1-a-dg9q       master  True
nodes-2f58                      node    True
nodes-9t48                      node    True

Your cluster jaehoonn-cluster.k8s.local is ready
jaehoonn@jaehoonn:~$
</code></pre></div><ul>
<li>kubectl 동작 확인</li>
</ul>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$ kubectl get pods --all-namespaces
NAMESPACE     NAME                                                READY   STATUS    RESTARTS   AGE
kube-system   dns-controller-7f9457558d-fmnpk                     1/1     Running   <span style="color:#3677a9">0</span>          4m53s
kube-system   etcd-manager-events-master-us-central1-a-dg9q       1/1     Running   <span style="color:#3677a9">0</span>          3m26s
kube-system   etcd-manager-main-master-us-central1-a-dg9q         1/1     Running   <span style="color:#3677a9">0</span>          4m4s
kube-system   kube-apiserver-master-us-central1-a-dg9q            1/1     Running   <span style="color:#3677a9">1</span>          4m27s
kube-system   kube-controller-manager-master-us-central1-a-dg9q   1/1     Running   <span style="color:#3677a9">0</span>          4m29s
kube-system   kube-dns-66d58c65d5-6nllr                           3/3     Running   <span style="color:#3677a9">0</span>          4m53s
kube-system   kube-dns-66d58c65d5-6qk7c                           3/3     Running   <span style="color:#3677a9">0</span>          3m55s
kube-system   kube-dns-autoscaler-6567f59ccb-xzp98                1/1     Running   <span style="color:#3677a9">0</span>          4m51s
kube-system   kube-proxy-master-us-central1-a-dg9q                1/1     Running   <span style="color:#3677a9">0</span>          4m6s
kube-system   kube-proxy-nodes-2f58                               1/1     Running   <span style="color:#3677a9">0</span>          3m41s
kube-system   kube-proxy-nodes-9t48                               1/1     Running   <span style="color:#3677a9">0</span>          3m25s
kube-system   kube-scheduler-master-us-central1-a-dg9q            1/1     Running   <span style="color:#3677a9">0</span>          4m33s
jaehoonn@jaehoonn:~$
</code></pre></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-8444244371421612"
     data-ad-slot="6693872766"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>


    </div>

    
<ul class="list-none pl-0 font-sm align-left">

<hr>
<li>
    Categories:

<a href="/categories/cloud">
    <span class="tag-item">
    cloud
    </span>
</a>
</li >


<li class="list-none">
    Tags:
    
    <a class="inline-block mt-2 mr-2 border-none text-neutral-800 dark:text-neutral-200" href="/tags/gcp">
        <span class="flex flex-row justify-start items-center dark:bg-zinc-900 dark:hover:bg-zinc-800
                     hover:bg-zinc-200 bg-zinc-100 p-1
                     rounded-t border-b-2 border-zinc-300 hover:border-zinc-500">
            
            <img class="h-5 mr-1 inline" src="https://shrinklabs.com/images/tag_logo.svg"
                 alt="Logo of a tag: indicates that a tag item follows.">
        gcp
        </span>
    </a>
    
    <a class="inline-block mt-2 mr-2 border-none text-neutral-800 dark:text-neutral-200" href="/tags/kubernetes">
        <span class="flex flex-row justify-start items-center dark:bg-zinc-900 dark:hover:bg-zinc-800
                     hover:bg-zinc-200 bg-zinc-100 p-1
                     rounded-t border-b-2 border-zinc-300 hover:border-zinc-500">
            
            <img class="h-5 mr-1 inline" src="https://shrinklabs.com/images/tag_logo.svg"
                 alt="Logo of a tag: indicates that a tag item follows.">
        kubernetes
        </span>
    </a>
    
</li>

</ul>


    
    
    <div class="article-date-modified">
        Last modified <span itemprop="dateModified" content="2020-03-05T21:36:13&#43;0900">2020-03-05</span>
    </div>
    
    </article>

    </main>
    <footer class="footer container h-10 text-center">
  <ul class="pl-0">
    
    <li class="ml-2 first:before:content-none before:content-['•'] inline-block list-none"><a class="ml-2 text-neutral-800 dark:text-neutral-400 border-none"
          href="https://github.com/hugcis/hugo-astatine-theme">Code</a>
    </li>
    <li class="ml-2 first:before:content-none before:content-['•']
                text-neutral-800 dark:text-neutral-400 inline-block list-none"><span class="ml-2">© Jaehoon Khim 2022</span>
    </li>
  </ul>
</footer>


  </body>
</html>
