<!DOCTYPE html>
<html lang="en">
  <head>
  	<meta charset="utf-8">
  	<meta name="viewport"    content="width=device-width, initial-scale=1.0">
  	<meta name="description" content="">
  	<meta name="author"      content="map[]">
    
    	<title>Posts</title>
    
    <script data-ad-client="ca-pub-8444244371421612" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


	<link rel="shortcut icon" href="https://shrinklabs.com/images/favicon.ico">

	
	<link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.no-icons.min.css" rel="stylesheet">
	
	
	<script defer src="https://use.fontawesome.com/releases/v5.0.11/js/all.js" integrity="sha384-ImVoB8Er8knetgQakxuBS4G3RSkyD8IZVVQCAnmRJrDwqJFYUE4YOv+DbIofcO9C" crossorigin="anonymous"></script>
	
	
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alice|Open+Sans:400,300,700">
	
	
  
  <link rel="stylesheet" href="https://shrinklabs.com/css/styles.min.64a6643395c6bf1ec6fff31d6429046b3ad467e58a279ff252dc019edd80a87051cf90b7fe2d589277def72d84602dcbc7115e2e17a94db3a8838336986a0ae3.css" integrity="sha512-ZKZkM5XGvx7G//MdZCkEazrUZ&#43;WKJ5/yUtwBnt2AqHBRz5C3/i1Yknfe9y2EYC3LxxFeLhepTbOog4M2mGoK4w==">

   
  

  </head>
  
  <body class="home">

    
      <header id="header">
  <div id="head" class="parallax" data-parallax-speed="2" style="background-image:url('https://shrinklabs.com/images/bg_head.jpg');">
    <h1 id="logo" class="text-center">
      <img class='img-circle' src="https://shrinklabs.com/images/logo.png" alt="">
      <span class="title"></span>
      <span class="tagline"><br>
        <a href="mailto:"></a>
      </span>
   </h1>
</div>

<nav class="navbar navbar-default navbar-sticky">
    <div class="container-fluid">

        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="true">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>

        <div class="navbar-collapse collapse" id="bs-example-navbar-collapse-1">

            <ul class="nav navbar-nav">
            
                
                <li>
                    <a href="/">home</a>
                </li>
                
            
                
                <li>
                    <a href="/post/">blog</a>
                </li>
                
            
            </ul>

        </div> 
        
    </div>
</nav>

</header>
    
 
    
<main id="main">

	<div class="container">
		<div class="row topspace">
			<div class="col-sm-8 col-sm-offset-2">

        
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
               <span class="posted-on">
                  <time class="entry-date published" datetime="April 8, 2020">April 8, 2020</time>
               </span>
						</div>
						<h1 class="entry-title">
						  <a href="https://shrinklabs.com/post/container_docker-error/" rel="bookmark">docker 설치 후 에러</a>
						</h1>
					</header>
					<div class="entry-content">
						<p>docker 설치 후 &ldquo;Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?&rdquo; 가 발생</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$sudo systemctl status docker

$sudo systemctl start docker

$sudo systemctl enable docker
</code></pre></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-8444244371421612"
     data-ad-slot="6693872766"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

					</div>
				</article>
        
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
               <span class="posted-on">
                  <time class="entry-date published" datetime="March 5, 2020">March 5, 2020</time>
               </span>
						</div>
						<h1 class="entry-title">
						  <a href="https://shrinklabs.com/post/container_k8s-with-kops-on-gce/" rel="bookmark">GCE에서 kops를 이용한 K8s 구성</a>
						</h1>
					</header>
					<div class="entry-content">
						<h1 id="클러스터-배포용-vm-인스턴스-생성">클러스터 배포용 VM 인스턴스 생성</h1>
<ul>
<li>Kubernetes를 구성하기 위한 VM 인스턴스를 생성합니다.</li>
<li>&ldquo;ID 및 API 액세스&rdquo; 항목에서 액세스 범위를 &ldquo;모든 Cloud API에 대한 전체 액세스 허용&rdquo; 으로 선택한다. 또는 아래와 같이 서비스 계정에 권한을 설정하고 서비스 계정을 선택해도 됩니다.
<ul>
<li>GCP 관리 콘솔의 IAM&amp;Admin에서 서비스 계정을 하나 만듭니다. 서비스 계정이 갖고 있어야 하는 최소한의 권한은 다음과 같습니다.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">compute admin
servce account admin
service account key admin
service account token creator
service acount user
storage admin
DNS Administrator
DNS Reader
</code></pre></div><ul>
<li>SSH로 연결 &amp; 업데이트</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$sudo apt-get update
jaehoonn@jaehoonn:~$sudo apt-get dist-upgrade
</code></pre></div></li>
</ul>
<h1 id="kubectl-설치">kubectl 설치</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$curl -LO https://storage.googleapis.com/kubernetes-release/release/<span style="color:#66d9ef">$(</span>curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt<span style="color:#66d9ef">)</span>/bin/linux/amd64/kubectl
jaehoonn@jaehoonn:~$chmod +x ./kubectl
jaehoonn@jaehoonn:~$sudo mv ./kubectl /usr/local/bin/kubectl
</code></pre></div><h1 id="kops-설치">kops 설치</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$wget -O kops https://github.com/kubernetes/kops/releases/download/<span style="color:#66d9ef">$(</span>curl -s https://api.github.com/repos/kubernetes/kops/releases/latest | grep tag_name | cut -d <span style="color:#e6db74">&#39;&#34;&#39;</span> -f 4<span style="color:#66d9ef">)</span>/kops-linux-amd64
jaehoonn@jaehoonn:~$chmod +x ./kops
jaehoonn@jaehoonn:~$sudo mv ./kops /usr/local/bin/
</code></pre></div><h1 id="gcp-tool-설치">GCP Tool 설치</h1>
<ul>
<li><a href="https://cloud.google.com/sdk/install">https://cloud.google.com/sdk/install</a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$export CLOUD_SDK_REPO<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cloud-sdk-</span><span style="color:#66d9ef">$(</span>lsb_release -c -s<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
jaehoonn@jaehoonn:~$echo <span style="color:#e6db74">&#34;deb http://packages.cloud.google.com/apt </span>$CLOUD_SDK_REPO<span style="color:#e6db74"> main&#34;</span> | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
jaehoonn@jaehoonn:~$sudo apt-get install apt-transport-https ca-certificates
jaehoonn@jaehoonn:~$curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
jaehoonn@jaehoonn:~$sudo apt-get update <span style="color:#f92672">&amp;&amp;</span> sudo apt-get install google-cloud-sdk
</code></pre></div><ul>
<li>추가 구성요소는 선택적으로 설치 합니다. ( sudo apt-get install )</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">google-cloud-sdk-app-engine-python
google-cloud-sdk-app-engine-python-extras
google-cloud-sdk-app-engine-java
google-cloud-sdk-app-engine-go
google-cloud-sdk-datalab
google-cloud-sdk-datastore-emulator
google-cloud-sdk-pubsub-emulator
google-cloud-sdk-cbt
google-cloud-sdk-cloud-build-local
google-cloud-sdk-bigtable-emulator
kubectl
</code></pre></div><ul>
<li>GCP를 시작하기 위한 초기화</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$gcloud init
Welcome! This command will take you through the configuration of gcloud.
Your current configuration has been set to: <span style="color:#f92672">[</span>default<span style="color:#f92672">]</span>
You can skip diagnostics next time by using the following flag:
  gcloud init --skip-diagnostics
Network diagnostic detects and fixes local network connection issues.
Checking network connection...done.                                                                                
Reachability Check passed.
Network diagnostic passed <span style="color:#f92672">(</span>1/1 checks passed<span style="color:#f92672">)</span>.
Choose the account you would like to use to perform operations <span style="color:#66d9ef">for</span> 
this configuration:
 <span style="color:#f92672">[</span>1<span style="color:#f92672">]</span> xxxxxxxxxxxx-compute@developer.gserviceaccount.com
 <span style="color:#f92672">[</span>2<span style="color:#f92672">]</span> Log in with a new account
Please enter your numeric choice: <span style="color:#ae81ff">1</span>

You are logged in as: <span style="color:#f92672">[</span>xxxxxxxxxxxx-compute@developer.gserviceaccount.com<span style="color:#f92672">]</span>.
Pick cloud project to use: 
 <span style="color:#f92672">[</span>1<span style="color:#f92672">]</span> jaehoonn-000000
 <span style="color:#f92672">[</span>2<span style="color:#f92672">]</span> Create a new project
Please enter numeric choice or text value <span style="color:#f92672">(</span>must exactly match list 
item<span style="color:#f92672">)</span>: <span style="color:#ae81ff">1</span>

Your current project has been set to: <span style="color:#f92672">[</span>jaehoonn-000000<span style="color:#f92672">]</span>.

Do you want to configure a default Compute Region and Zone? <span style="color:#f92672">(</span>Y/n<span style="color:#f92672">)</span>? y

Which Google Compute Engine zone would you like to use as project 
default?
If you <span style="color:#66d9ef">do</span> not specify a zone via a command line flag <span style="color:#66d9ef">while</span> working 
with Compute Engine resources, the default is assumed.
 <span style="color:#f92672">[</span>1<span style="color:#f92672">]</span> us-east1-b
 <span style="color:#f92672">[</span>2<span style="color:#f92672">]</span> us-east1-c
 <span style="color:#f92672">[</span>3<span style="color:#f92672">]</span> us-east1-d
 <span style="color:#f92672">[</span>4<span style="color:#f92672">]</span> us-east4-c
 <span style="color:#f92672">[</span>5<span style="color:#f92672">]</span> us-east4-b
 <span style="color:#f92672">[</span>6<span style="color:#f92672">]</span> us-east4-a
 <span style="color:#f92672">[</span>7<span style="color:#f92672">]</span> us-central1-c
 <span style="color:#f92672">[</span>8<span style="color:#f92672">]</span> us-central1-a
 <span style="color:#f92672">[</span>9<span style="color:#f92672">]</span> us-central1-f
 <span style="color:#f92672">[</span>10<span style="color:#f92672">]</span> us-central1-b
 <span style="color:#f92672">[</span>11<span style="color:#f92672">]</span> us-west1-b
 <span style="color:#f92672">[</span>12<span style="color:#f92672">]</span> us-west1-c
 <span style="color:#f92672">[</span>13<span style="color:#f92672">]</span> us-west1-a
 <span style="color:#f92672">[</span>14<span style="color:#f92672">]</span> europe-west4-a
 <span style="color:#f92672">[</span>15<span style="color:#f92672">]</span> europe-west4-b
 <span style="color:#f92672">[</span>16<span style="color:#f92672">]</span> europe-west4-c
 <span style="color:#f92672">[</span>17<span style="color:#f92672">]</span> europe-west1-b
 <span style="color:#f92672">[</span>18<span style="color:#f92672">]</span> europe-west1-d
 <span style="color:#f92672">[</span>19<span style="color:#f92672">]</span> europe-west1-c
 <span style="color:#f92672">[</span>20<span style="color:#f92672">]</span> europe-west3-c
 <span style="color:#f92672">[</span>21<span style="color:#f92672">]</span> europe-west3-a
 <span style="color:#f92672">[</span>22<span style="color:#f92672">]</span> europe-west3-b
 <span style="color:#f92672">[</span>23<span style="color:#f92672">]</span> europe-west2-c
 <span style="color:#f92672">[</span>24<span style="color:#f92672">]</span> europe-west2-b
 <span style="color:#f92672">[</span>25<span style="color:#f92672">]</span> europe-west2-a
 <span style="color:#f92672">[</span>26<span style="color:#f92672">]</span> asia-east1-b
 <span style="color:#f92672">[</span>27<span style="color:#f92672">]</span> asia-east1-a
 <span style="color:#f92672">[</span>28<span style="color:#f92672">]</span> asia-east1-c
 <span style="color:#f92672">[</span>29<span style="color:#f92672">]</span> asia-southeast1-b
 <span style="color:#f92672">[</span>30<span style="color:#f92672">]</span> asia-southeast1-a
 <span style="color:#f92672">[</span>31<span style="color:#f92672">]</span> asia-southeast1-c
 <span style="color:#f92672">[</span>32<span style="color:#f92672">]</span> asia-northeast1-b
 <span style="color:#f92672">[</span>33<span style="color:#f92672">]</span> asia-northeast1-c
 <span style="color:#f92672">[</span>34<span style="color:#f92672">]</span> asia-northeast1-a
 <span style="color:#f92672">[</span>35<span style="color:#f92672">]</span> asia-south1-c
 <span style="color:#f92672">[</span>36<span style="color:#f92672">]</span> asia-south1-b
 <span style="color:#f92672">[</span>37<span style="color:#f92672">]</span> asia-south1-af
 <span style="color:#f92672">[</span>38<span style="color:#f92672">]</span> australia-southeast1-b
 <span style="color:#f92672">[</span>39<span style="color:#f92672">]</span> australia-southeast1-c
 <span style="color:#f92672">[</span>40<span style="color:#f92672">]</span> australia-southeast1-a
 <span style="color:#f92672">[</span>41<span style="color:#f92672">]</span> southamerica-east1-b
 <span style="color:#f92672">[</span>42<span style="color:#f92672">]</span> southamerica-east1-c
 <span style="color:#f92672">[</span>43<span style="color:#f92672">]</span> southamerica-east1-a
 <span style="color:#f92672">[</span>44<span style="color:#f92672">]</span> asia-east2-a
 <span style="color:#f92672">[</span>45<span style="color:#f92672">]</span> asia-east2-b
 <span style="color:#f92672">[</span>46<span style="color:#f92672">]</span> asia-east2-c
 <span style="color:#f92672">[</span>47<span style="color:#f92672">]</span> asia-northeast2-a
 <span style="color:#f92672">[</span>48<span style="color:#f92672">]</span> asia-northeast2-b
 <span style="color:#f92672">[</span>49<span style="color:#f92672">]</span> asia-northeast2-c
 <span style="color:#f92672">[</span>50<span style="color:#f92672">]</span> europe-north1-a
Did not print <span style="color:#f92672">[</span>12<span style="color:#f92672">]</span> options.
Too many options <span style="color:#f92672">[</span>62<span style="color:#f92672">]</span>. Enter <span style="color:#e6db74">&#34;list&#34;</span> at prompt to print choices fully.
Please enter numeric choice or text value <span style="color:#f92672">(</span>must exactly match list 
item<span style="color:#f92672">)</span>: <span style="color:#ae81ff">8</span>

Your project default Compute Engine zone has been set to <span style="color:#f92672">[</span>us-central1-a<span style="color:#f92672">]</span>.
You can change it by running <span style="color:#f92672">[</span>gcloud config set compute/zone NAME<span style="color:#f92672">]</span>.
Your project default Compute Engine region has been set to <span style="color:#f92672">[</span>us-central1<span style="color:#f92672">]</span>.
You can change it by running <span style="color:#f92672">[</span>gcloud config set compute/region NAME<span style="color:#f92672">]</span>.
Created a default .boto configuration file at <span style="color:#f92672">[</span>/home/jaehoonn/.boto<span style="color:#f92672">]</span>. See this file and
<span style="color:#f92672">[</span>https://cloud.google.com/storage/docs/gsutil/commands/config<span style="color:#f92672">]</span> <span style="color:#66d9ef">for</span> more
information about configuring Google Cloud Storage.
Your Google Cloud SDK is configured and ready to use!
* Commands that require authentication will use xxxxxxxxxxxx-compute@developer.gserviceaccount.com by default
* Commands will reference project <span style="color:#e6db74">`</span>jaehoonn-000000<span style="color:#e6db74">`</span> by default
* Compute Engine commands will use region <span style="color:#e6db74">`</span>us-central1<span style="color:#e6db74">`</span> by default
* Compute Engine commands will use zone <span style="color:#e6db74">`</span>us-central1-a<span style="color:#e6db74">`</span> by default
Run <span style="color:#e6db74">`</span>gcloud help config<span style="color:#e6db74">`</span> to learn how to change individual settings
This gcloud configuration is called <span style="color:#f92672">[</span>default<span style="color:#f92672">]</span>. You can create additional configurations <span style="color:#66d9ef">if</span> you work with multiple accounts and/or projects.
Run <span style="color:#e6db74">`</span>gcloud topic configurations<span style="color:#e6db74">`</span> to learn more.
Some things to try next:
* Run <span style="color:#e6db74">`</span>gcloud --help<span style="color:#e6db74">`</span> to see the Cloud Platform services you can interact with. And run <span style="color:#e6db74">`</span>gcloud help COMMAND<span style="color:#e6db74">`</span> to get help on any gcloud command.
* Run <span style="color:#e6db74">`</span>gcloud topic --help<span style="color:#e6db74">`</span> to learn about advanced features of the SDK like arg files and output formatting
jaehoonn@jaehoonn:~$
</code></pre></div><ul>
<li>선택 사항
<ul>
<li>&ldquo;Please enter your numeric choice: 1&rdquo;
<ul>
<li>연결되어 있는 서비스 계정인 &ldquo;[1] <a href="mailto:xxxxxxxxxxxx-compute@developer.gserviceaccount.com">xxxxxxxxxxxx-compute@developer.gserviceaccount.com</a>&rdquo; 를 선택</li>
</ul>
</li>
<li>&ldquo;Please enter numeric choice or text value (must exactly match list 
item): 1&rdquo;
<ul>
<li>연결하고자 하는 프로젝트인 &ldquo;[1] jaehoonn-000000&rdquo; 를 선택</li>
</ul>
</li>
<li>&ldquo;Do you want to configure a default Compute Region and Zone? (Y/n)? y&rdquo;
<ul>
<li>기본으로 제공되고 있는 region과 zone을 사용</li>
</ul>
</li>
<li>&ldquo;Please enter numeric choice or text value (must exactly match list 
item): 8&rdquo;</li>
</ul>
</li>
</ul>
<h1 id="스토리지버킷-생성">스토리지(버킷) 생성</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$ gsutil mb gs://jaehoonn-cluster-state-store
Creating gs://jaehoonn-cluster-state-store/...
jaehoonn@jaehoonn:~$ export KOPS_STATE_STORE<span style="color:#f92672">=</span>gs://jaehoonn-cluster-state-store/
</code></pre></div><ul>
<li>kops는 클러스터 구성을 유지하기 위한 상태 저장소로서 &ldquo;Storage&quot;의 &ldquo;Bucket&quot;을 이용합니다.
<ul>
<li>mb: Make buckets</li>
</ul>
</li>
<li>Bucket의 이름은 필요한 형태로 만들면 됩니다. (ex, jaehoonn-cluster-state-store)</li>
</ul>
<h1 id="클러스터-생성">클러스터 생성</h1>
<ul>
<li>Google Cloud에서 사용할 정보</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$ PROJECT<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>gcloud config get-value project<span style="color:#e6db74">`</span>
jaehoonn@jaehoonn:~$ export KOPS_FEATURE_FLAGS<span style="color:#f92672">=</span>AlphaAllowGCE <span style="color:#75715e"># to unlock the GCE features</span>
</code></pre></div><ul>
<li>Kubernetes 클러스터 생성(상태 저장소)</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$ kops create cluster --name<span style="color:#f92672">=</span>jaehoonn-cluster.k8s.local --zones<span style="color:#f92672">=</span>us-central1-a --state<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KOPS_STATE_STORE<span style="color:#e6db74">}</span> --project<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>

ManagedFile/jaehoonn-cluster.k8s.local-addons-dns-controller.addons.k8s.io-k8s-1.6
        Location                addons/dns-controller.addons.k8s.io/k8s-1.6.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-dns-controller.addons.k8s.io-pre-k8s-1.6
        Location                addons/dns-controller.addons.k8s.io/pre-k8s-1.6.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-kube-dns.addons.k8s.io-k8s-1.12
        Location                addons/kube-dns.addons.k8s.io/k8s-1.12.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-kube-dns.addons.k8s.io-k8s-1.6
        Location                addons/kube-dns.addons.k8s.io/k8s-1.6.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-kube-dns.addons.k8s.io-pre-k8s-1.6
        Location                addons/kube-dns.addons.k8s.io/pre-k8s-1.6.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-kubelet-api.rbac.addons.k8s.io-k8s-1.9
        Location                addons/kubelet-api.rbac.addons.k8s.io/k8s-1.9.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-limit-range.addons.k8s.io
        Location                addons/limit-range.addons.k8s.io/v1.5.0.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-rbac.addons.k8s.io-k8s-1.8
        Location                addons/rbac.addons.k8s.io/k8s-1.8.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-storage-gce.addons.k8s.io-v1.6.0
        Location                addons/storage-gce.addons.k8s.io/v1.6.0.yaml

  ManagedFile/jaehoonn-cluster.k8s.local-addons-storage-gce.addons.k8s.io-v1.7.0
        Location                addons/storage-gce.addons.k8s.io/v1.7.0.yaml

  ManagedFile/etcd-cluster-spec-events
        Location                backups/etcd/events/control/etcd-cluster-spec

  ManagedFile/etcd-cluster-spec-main
        Location                backups/etcd/main/control/etcd-cluster-spec

  ManagedFile/manifests-etcdmanager-events
        Location                manifests/etcd/events.yaml

  ManagedFile/manifests-etcdmanager-main
        Location                manifests/etcd/main.yaml

  Secret/admin

  Secret/kube

  Secret/kube-proxy

  Secret/kubelet

  Secret/system:controller_manager

  Secret/system:dns

  Secret/system:logging

  Secret/system:monitoring

  Secret/system:scheduler

  StorageBucketAcl/serviceaccount-backup-readwrite-jaehoonn-cluster-state-store
        Bucket                  jaehoonn-cluster-state-store
        Entity                  xxxx-000000000000-compute@developer.gserviceaccount.com
        Role                    WRITER

  TargetPool/api-jaehoonn-cluster-k8s-local

Must specify --yes to apply changes

Cluster configuration has been created.

Suggestions:
 * list clusters with: kops get cluster
 * edit this cluster with: kops edit cluster jaehoonn-cluster.k8s.local
 * edit your node instance group: kops edit ig --name<span style="color:#f92672">=</span>jaehoonn-cluster.k8s.local nodes
 * edit your master instance group: kops edit ig --name<span style="color:#f92672">=</span>jaehoonn-cluster.k8s.local master-us-central1-a

Finally configure your cluster with: kops update cluster --name jaehoonn-cluster.k8s.local --yes

jaehoonn@jaehoonn:~$
</code></pre></div><ul>
<li>Kubernetes 클러스터 생성(VM 인스턴스에 직접 생성)</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$ kops update cluster --name jaehoonn-cluster.k8s.local --yes
I1106 05:42:52.576477   <span style="color:#ae81ff">26628</span> apply_cluster.go:559<span style="color:#f92672">]</span> Gossip DNS: skipping DNS validation
W1106 05:42:52.641383   <span style="color:#ae81ff">26628</span> external_access.go:36<span style="color:#f92672">]</span> TODO: Harmonize gcemodel ExternalAccessModelBuilder with awsmodel
W1106 05:42:52.641597   <span style="color:#ae81ff">26628</span> firewall.go:35<span style="color:#f92672">]</span> TODO: Harmonize gcemodel with awsmodel <span style="color:#66d9ef">for</span> firewall - GCE model is way too open
W1106 05:42:52.641685   <span style="color:#ae81ff">26628</span> firewall.go:63<span style="color:#f92672">]</span> Adding overlay network <span style="color:#66d9ef">for</span> X -&gt; node rule - HACK
W1106 05:42:52.641750   <span style="color:#ae81ff">26628</span> firewall.go:64<span style="color:#f92672">]</span> We should probably use subnets?
W1106 05:42:52.641824   <span style="color:#ae81ff">26628</span> firewall.go:118<span style="color:#f92672">]</span> Adding overlay network <span style="color:#66d9ef">for</span> X -&gt; master rule - HACK
W1106 05:42:52.770317   <span style="color:#ae81ff">26628</span> storageacl.go:71<span style="color:#f92672">]</span> we need to split master / node roles
W1106 05:42:52.770353   <span style="color:#ae81ff">26628</span> storageacl.go:86<span style="color:#f92672">]</span> adding bucket level write ACL to gs://jaehoonn-cluster-state-store to support etcd backup
W1106 05:42:52.770450   <span style="color:#ae81ff">26628</span> autoscalinggroup.go:108<span style="color:#f92672">]</span> enabling storage-rw <span style="color:#66d9ef">for</span> etcd backups
I1106 05:42:54.889249   <span style="color:#ae81ff">26628</span> executor.go:103<span style="color:#f92672">]</span> Tasks: <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">done</span> / <span style="color:#ae81ff">66</span> total; <span style="color:#ae81ff">39</span> can run
I1106 05:42:55.253887   <span style="color:#ae81ff">26628</span> address.go:123<span style="color:#f92672">]</span> GCE creating address: <span style="color:#e6db74">&#34;api-jaehoonn-cluster-k8s-local&#34;</span>
I1106 05:42:55.387139   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;etcd-peers-ca-events&#34;</span>
I1106 05:42:55.672462   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;apiserver-aggregator-ca&#34;</span>
I1106 05:42:55.765508   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;etcd-manager-ca-main&#34;</span>
I1106 05:42:55.985020   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;etcd-peers-ca-main&#34;</span>
I1106 05:42:56.327905   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;etcd-clients-ca&#34;</span>
I1106 05:42:56.593223   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;ca&#34;</span>
I1106 05:42:56.803652   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;etcd-manager-ca-events&#34;</span>
I1106 05:43:08.063339   <span style="color:#ae81ff">26628</span> executor.go:103<span style="color:#f92672">]</span> Tasks: <span style="color:#ae81ff">39</span> <span style="color:#66d9ef">done</span> / <span style="color:#ae81ff">66</span> total; <span style="color:#ae81ff">25</span> can run
I1106 05:43:08.238400   <span style="color:#ae81ff">26628</span> instancetemplate.go:214<span style="color:#f92672">]</span> We should be using NVME <span style="color:#66d9ef">for</span> GCE
I1106 05:43:08.240753   <span style="color:#ae81ff">26628</span> instancetemplate.go:214<span style="color:#f92672">]</span> We should be using NVME <span style="color:#66d9ef">for</span> GCE
I1106 05:43:08.248537   <span style="color:#ae81ff">26628</span> instancetemplate.go:214<span style="color:#f92672">]</span> We should be using NVME <span style="color:#66d9ef">for</span> GCE
I1106 05:43:08.249786   <span style="color:#ae81ff">26628</span> instancetemplate.go:214<span style="color:#f92672">]</span> We should be using NVME <span style="color:#66d9ef">for</span> GCE
I1106 05:43:10.777593   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;kube-controller-manager&#34;</span>
I1106 05:43:11.412793   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;kube-scheduler&#34;</span>
I1106 05:43:11.665669   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;apiserver-proxy-client&#34;</span>
I1106 05:43:11.698639   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;apiserver-aggregator&#34;</span>
I1106 05:43:12.071948   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;kubelet-api&#34;</span>
I1106 05:43:12.189613   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;kubelet&#34;</span>
I1106 05:43:12.465094   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;kops&#34;</span>
I1106 05:43:12.539693   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;master&#34;</span>
I1106 05:43:12.633503   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;kube-proxy&#34;</span>
I1106 05:43:12.812512   <span style="color:#ae81ff">26628</span> vfs_castore.go:729<span style="color:#f92672">]</span> Issuing new certificate: <span style="color:#e6db74">&#34;kubecfg&#34;</span>
I1106 05:43:21.263578   <span style="color:#ae81ff">26628</span> executor.go:103<span style="color:#f92672">]</span> Tasks: <span style="color:#ae81ff">64</span> <span style="color:#66d9ef">done</span> / <span style="color:#ae81ff">66</span> total; <span style="color:#ae81ff">2</span> can run
I1106 05:43:32.802331   <span style="color:#ae81ff">26628</span> executor.go:103<span style="color:#f92672">]</span> Tasks: <span style="color:#ae81ff">66</span> <span style="color:#66d9ef">done</span> / <span style="color:#ae81ff">66</span> total; <span style="color:#ae81ff">0</span> can run
I1106 05:43:33.070437   <span style="color:#ae81ff">26628</span> update_cluster.go:294<span style="color:#f92672">]</span> Exporting kubecfg <span style="color:#66d9ef">for</span> cluster
kops has set your kubectl context to jaehoonn-cluster.k8s.local

Cluster is starting.  It should be ready in a few minutes.

Suggestions:
 * validate cluster: kops validate cluster
 * list nodes: kubectl get nodes --show-labels
 * ssh to the master: ssh -i ~/.ssh/id_rsa admin@api.jaehoonn-cluster.k8s.local
 * the admin user is specific to Debian. If not using Debian please use the appropriate user based on your OS.
 * read about installing addons at: https://github.com/kubernetes/kops/blob/master/docs/addons.md.

jaehoonn@jaehoonn:~$
</code></pre></div><ul>
<li>클러스터 상태 확인(클러스터 생성 완료되고 5~10분뒤에 확인)</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$ kops validate cluster
Using cluster from kubectl context: jaehoonn-cluster.k8s.local

Validating cluster jaehoonn-cluster.k8s.local

I1106 05:50:12.213436   <span style="color:#ae81ff">26733</span> gce_cloud.go:273<span style="color:#f92672">]</span> Scanning zones: <span style="color:#f92672">[</span>us-central1-c us-central1-a us-central1-f us-central1-b<span style="color:#f92672">]</span>
INSTANCE GROUPS
NAME                    ROLE    MACHINETYPE     MIN     MAX     SUBNETS
master-us-central1-a    Master  n1-standard-1   <span style="color:#ae81ff">1</span>       <span style="color:#ae81ff">1</span>       us-central1
nodes                   Node    n1-standard-2   <span style="color:#ae81ff">2</span>       <span style="color:#ae81ff">2</span>       us-central1

NODE STATUS
NAME                            ROLE    READY
master-us-central1-a-dg9q       master  True
nodes-2f58                      node    True
nodes-9t48                      node    True

Your cluster jaehoonn-cluster.k8s.local is ready
jaehoonn@jaehoonn:~$
</code></pre></div><ul>
<li>kubectl 동작 확인</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jaehoonn@jaehoonn:~$ kubectl get pods --all-namespaces
NAMESPACE     NAME                                                READY   STATUS    RESTARTS   AGE
kube-system   dns-controller-7f9457558d-fmnpk                     1/1     Running   <span style="color:#ae81ff">0</span>          4m53s
kube-system   etcd-manager-events-master-us-central1-a-dg9q       1/1     Running   <span style="color:#ae81ff">0</span>          3m26s
kube-system   etcd-manager-main-master-us-central1-a-dg9q         1/1     Running   <span style="color:#ae81ff">0</span>          4m4s
kube-system   kube-apiserver-master-us-central1-a-dg9q            1/1     Running   <span style="color:#ae81ff">1</span>          4m27s
kube-system   kube-controller-manager-master-us-central1-a-dg9q   1/1     Running   <span style="color:#ae81ff">0</span>          4m29s
kube-system   kube-dns-66d58c65d5-6nllr                           3/3     Running   <span style="color:#ae81ff">0</span>          4m53s
kube-system   kube-dns-66d58c65d5-6qk7c                           3/3     Running   <span style="color:#ae81ff">0</span>          3m55s
kube-system   kube-dns-autoscaler-6567f59ccb-xzp98                1/1     Running   <span style="color:#ae81ff">0</span>          4m51s
kube-system   kube-proxy-master-us-central1-a-dg9q                1/1     Running   <span style="color:#ae81ff">0</span>          4m6s
kube-system   kube-proxy-nodes-2f58                               1/1     Running   <span style="color:#ae81ff">0</span>          3m41s
kube-system   kube-proxy-nodes-9t48                               1/1     Running   <span style="color:#ae81ff">0</span>          3m25s
kube-system   kube-scheduler-master-us-central1-a-dg9q            1/1     Running   <span style="color:#ae81ff">0</span>          4m33s
jaehoonn@jaehoonn:~$
</code></pre></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-8444244371421612"
     data-ad-slot="6693872766"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

					</div>
				</article>
        
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
               <span class="posted-on">
                  <time class="entry-date published" datetime="March 5, 2020">March 5, 2020</time>
               </span>
						</div>
						<h1 class="entry-title">
						  <a href="https://shrinklabs.com/post/container_docker-image/" rel="bookmark">docker image 저장소 위치 변경</a>
						</h1>
					</header>
					<div class="entry-content">
						<ul>
<li>새로운 디스크를 추가합니다.
<ul>
<li>여기에서는 &ldquo;/docker&rdquo; 에 mount 되어 있는걸로 가정합니다.</li>
</ul>
</li>
<li>&ldquo;etc/docker/daemon.json&rdquo; 에 다음의 내용을 추가합니다.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;data-root&#34;</span>: <span style="color:#e6db74">&#34;/docker&#34;</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>docker 서비스를 재시작합니다.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo systemctl daemon-reload
$ sudo systemctl restart docker
</code></pre></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-8444244371421612"
     data-ad-slot="6693872766"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

					</div>
				</article>
        
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
               <span class="posted-on">
                  <time class="entry-date published" datetime="January 21, 2019">January 21, 2019</time>
               </span>
						</div>
						<h1 class="entry-title">
						  <a href="https://shrinklabs.com/post/container_nginx-ingress-controller-on-google-kubernetes-engine/" rel="bookmark">10.Nginx Ingress Controller on Google Kubernetes Engine</a>
						</h1>
					</header>
					<div class="entry-content">
						<p>이번 과정에서는 &ldquo;Ingress&quot;에 대해서 알아 볼 수 있었습니다.</p>
<p>&ldquo;Ingress&quot;는 resource와 controller로 구성되어 있습니다.</p>
<p>resource는 &ldquo;Ingress&quot;의 동작에 대한 규칙을 정해 놓은 yaml이며,</p>
<p>controller는 layer7에 해당하는 로드밸런서의 역할을 제공합니다. 즉 http 요청에 대한 처리와 부하 분산을 제공합니다.</p>
<p>controller로는 gce, nginx, envoy, haproxy, istio, kong, traefik 을 이용할 수 있습니다.</p>
<p>과정에서는 &ldquo;hello-app&rdquo; 이라는 &ldquo;Service&quot;를 노출합니다. 그리고 helm을 이용해서 nginx-ingress를 kubernetes cluster에 설치합니다.</p>
<p>kind가 &ldquo;Ingress&quot;인 yaml 파일을 만듭니다. 이때 &ldquo;path: /hello&quot;로 지정하며, backend를 &ldquo;serviceName: hello-app&quot;과 &ldquo;servicePort: 8080&rdquo; 으로 지정을 합니다.</p>
<p>이렇게 해서 &ldquo;nginx-ingress-controller&quot;가 제공하는 &ldquo;EXTERNAL-IP&quot;에 &ldquo;/hello&quot;로 웹브라우저에서 연결을 해보면 서비스가 제공되는 것을 확인해 볼 수 있습니다.</p>
<p>&ldquo;Ingress&quot;를 통해서 로드밸런서를 제공하기 위해서는 &ldquo;Service&rdquo; 생성 과정에서 type의 지정이 필요합니다.</p>
<p>&ldquo;Pod&quot;는 죽고 사는 과정이 계속해서 반복되고 ip가 계속해서 변동됩니다.</p>
<p>이러한 &ldquo;Pod&quot;를 선택적으로 동일한 ip로 접근하기 위해서 &ldquo;Service&quot;를 사용합니다.</p>
<p>이 &ldquo;Service&quot;들이 제공하는 타입에 따라서 서비스가 제공되는 형태가 변경이 됩니다.</p>
<p>clusterip는 클러스터 내부에서만 접근 가능한 형태의 service 입니다.</p>
<p>그리고 nodeport는 &ldquo;node이름:port&quot;로 외부에서도 접근이 가능하도록 서비스를 제공하는 형태입니다.</p>
<p>loadbalancer는 클라우드 서비스를 제공하는 벤더들에서 제공하는 로드밸런서를 사용합니다.</p>
<p>마지막으로 externalname은 외부의 서비스를 클러스터 내부에서 사용하고자 할 때 사용하는 형태입니다.</p>
<p>이와 같이 클라우드 서비스 벤더에서 제공하는 로드밸런서를 사용할때는 &ldquo;Service&quot;의 타입을 loadbalancer로 지정하고, &ldquo;Ingress&quot;를 통해서 제공하는 로드밸런서를 사용할때는 nodeport를 사용해서 &ldquo;Service&quot;를 생성합니다.</p>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-8444244371421612"
     data-ad-slot="6693872766"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

					</div>
				</article>
        
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
               <span class="posted-on">
                  <time class="entry-date published" datetime="January 17, 2019">January 17, 2019</time>
               </span>
						</div>
						<h1 class="entry-title">
						  <a href="https://shrinklabs.com/post/container_helm-package-management/" rel="bookmark">9.Helm Package Management</a>
						</h1>
					</header>
					<div class="entry-content">
						<p>이번 과정은 kubernetes에서 사용할 수 있는 패키지 관리자에 대해서 알아 볼 수 있었습니다.</p>
<p>Helm은 클라이언트 역할을 하는 helm, 서버 역할을 하는 tiller 그리고 설정 정보들의 관리를 위한 chart로 이루어져 있습니다.</p>
<p>여기에서 클라이언트(helm)라고 하는건 클러스터의 외부에서 작업을 지시하기 위한 도구이고, 실제로 클러스터 안쪽에서 동작 하는건 서버(tiller)라고 보면 됩니다.</p>
<p>helm의 설치는 간단합니다.</p>
<pre><code>$ curl https://raw.githubusercontent.com/kubernetes/helm/master/scripts/get &gt; get_helm.sh

$ chmod 700 get_helm.sh

$ ./get_helm.sh
</code></pre><p>근데 이 과정 다음에 갑자기 tiller를 위한 계정을 만들고 해당 계정을 무언가에 바인딩을 합니다.</p>
<p>이 과정은 tiller가 클러스터 전체에서 권한을 갖기 위한 방법으로 여기면 될 것 같습니다.</p>
<p>비교가 적절할지 모르겠지만, 리눅스에서는 &ldquo;sudo&rdquo; 로 권한을 얻고, 윈도우에서 &ldquo;관리자 권한&quot;을 얻는 것 처럼 tiller에게도 더 높은 권한을 갖을 수 있도록 해주는 과정이라고 이해를 했습니다.</p>
<p>(권한에 대한 내용은 &ldquo;<a href="http://bcho.tistory.com/1272%22">http://bcho.tistory.com/1272&quot;</a> 를 참고하면 좋을것 같습니다.)</p>
<p>계정을 생성하고 권한을 설정하는 과정은 다음과 같습니다.</p>
<pre><code>$ kubectl -n kube-system create serviceaccount tiller

$ kubectl create clusterrolebinding tiller --clusterrole cluster-admin --serviceaccount=kube-system:tiller
</code></pre><p>그리고 권한을 제거하고 계정을 삭제하는 과정은 다음과 같이합니다.</p>
<pre><code>$ kubectl delete clusterrolebinding tiller

$ kubectl -n kube-system delete serviceaccount tiller
</code></pre><p>이러한 과정은 kubernetes의 권한 관리 방식을 rbac를 이용할 경우에 이렇게 하고, rbac 이외에 abac라는 방식은 다른 방법이 존재하는것 같습니다.</p>
<p>계정을 생성했으면 tiller를 설치합니다.</p>
<pre><code>$ helm init --service-account=tiller
</code></pre><p>tiller가 설치된 후에 &ldquo;kubectl get po &ndash;namespace kube-system&rdquo; 로 확인해 보면 &ldquo;tiller-deploy-blahblah&quot;가 실행되고 있는걸 확인 할 수 있습니다.</p>
<p>그리고 tiller를 제거하기 위해서는</p>
<pre><code>$ kubectl -n kube-system delete deployment tiller-deploy
</code></pre><p>를 해주고 위에서 이야기했던 권한 제거하는 작업을 해주면 됩니다.</p>
<p>그리고 chart를 업데이트하고 chart를 이용해서 설치하는 과정은 아무런 고민없이 사용이 가능할 정도로 간단합니다.</p>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-8444244371421612"
     data-ad-slot="6693872766"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

					</div>
				</article>
        
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
               <span class="posted-on">
                  <time class="entry-date published" datetime="January 16, 2019">January 16, 2019</time>
               </span>
						</div>
						<h1 class="entry-title">
						  <a href="https://shrinklabs.com/post/container_setting-up-private-kubernetes-cluster/" rel="bookmark">8.Setting Up a Private Kubernetes Cluster</a>
						</h1>
					</header>
					<div class="entry-content">
						<p>이번 과정의 실습을 진행하면서 클러스터에 대한 접근을 제한 할 수 있도록 하기 위한 방법에 대해서 알 수 있었습니다. 하지만 전체 내용에 대해서 정확하게 이해를 하지 못했습니다.</p>
<p>해당 내용은 이후에 비공개 클러스터 설정(<a href="https://cloud.google.com/kubernetes-engine/docs/how-to/private-clusters">https://cloud.google.com/kubernetes-engine/docs/how-to/private-clusters</a>) 에 대한 내용이 실습 내용과 동일하므로 추후에 이해가 가능한 시점이 되면 다시 한번 시도해 보려고 합니다.</p>
<p>아래는 내용을 이해하기 위해서 학습했던 내용들의 링크입니다.</p>
<ul>
<li>
<p>네트워크 입문: <a href="http://kujung.tistory.com/category/%EB%98%A5%20%EC%8B%B8%EA%B8%B0/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC">http://kujung.tistory.com/category/%EB%98%A5%20%EC%8B%B8%EA%B8%B0/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC</a></p>
</li>
<li>
<p>IPv4 네트워크 주소와 호스트 주소/서브넷팅/IP Class: <a href="http://itsaessak.tistory.com/174">http://itsaessak.tistory.com/174</a></p>
</li>
<li>
<p>IP 주소체계와 클래스 구별법 (IPV4): <a href="http://korean-daeddo.blogspot.com/2015/12/ip.html">http://korean-daeddo.blogspot.com/2015/12/ip.html</a></p>
</li>
<li>
<p>서브넷 마스크와 서브넷팅 계산법: <a href="http://korean-daeddo.blogspot.com/2016/01/blog-post_26.html">http://korean-daeddo.blogspot.com/2016/01/blog-post_26.html</a></p>
</li>
</ul>
<p>그리고 구글 클라우드 플랫폼 서비스에서 제공하는 GKE 관련 문서(<a href="https://cloud.google.com/kubernetes-engine/docs/">https://cloud.google.com/kubernetes-engine/docs/</a>) 들 중에서 함께 보면 도움이 되는 부분들입니다.</p>
<ul>
<li>
<p>별칭 IP를 사용하여 VPC 네이티브 클러스터 만들기: <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/alias-ips?hl=ko">https://cloud.google.com/kubernetes-engine/docs/how-to/alias-ips?hl=ko</a></p>
</li>
<li>
<p>네트워크 개요: <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/network-overview?hl=ko">https://cloud.google.com/kubernetes-engine/docs/concepts/network-overview?hl=ko</a></p>
</li>
</ul>
<p>그 외에도 &ldquo;CIDR&rdquo; 에 대해서 학습을 할 수 있었습니다.</p>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-8444244371421612"
     data-ad-slot="6693872766"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

					</div>
				</article>
        
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
               <span class="posted-on">
                  <time class="entry-date published" datetime="January 14, 2019">January 14, 2019</time>
               </span>
						</div>
						<h1 class="entry-title">
						  <a href="https://shrinklabs.com/post/container_build-slack-bot-with-nodejs-on-kubernetes/" rel="bookmark">7.Build Slack Bot With Node.js on Kubernetes</a>
						</h1>
					</header>
					<div class="entry-content">
						<p>이번 과정은 Secret 객체에 대해서 좀 더 자세하게 알아볼 수 있는 과정이었습니다.</p>
<p>서비스를 제공하는 프로그램(node.js 코드)을 Docker image로 만든 다음 Registry Server에 Push를 합니다.</p>
<p>제공하는 서비스에서 외부의 서비스(slack)를 사용하기 위해서 민감한 정보인 token이 존재한다. 이 내용이 코드상 또는 image 상에 존재하지 않게 Image를 만들고자 합니다.</p>
<p>그래서 별도로 &ldquo;slack-token&rdquo; 파일을 만들어서 파일을 통해서 token 정보를 제공하도록 만들어 놓았습니다. 해당 파일을 경로와 파일명을 포함해서 환경변수 &ldquo;slack_token_path&quot;에 등록해 놓고, 코드상에서는 환경 변수인 &ldquo;slack_token_path&quot;에 지정되어 있는 경로의 파일로 부터 token 정보를 읽어서 사용합니다.</p>
<p>실습 과정에서 보여지는 Docker image를 만드는 Dockerfile에는 token 정보를 다루고 있지 않습니다. 이를 통해서 해당 정보는 배포가 되지 않는다는걸 알 수 있습니다.</p>
<p>이제 Kubernetes 클러스터에서 배포를 하기 위해서 token 정보를 container들이 인식할 수 있도록 해주어야 합니다.</p>
<p>그래서 token 정보를 Secret으로 생성해서 클러스터에 배포합니다.</p>
<p>다시 반복해서 확인을 해보면, container에서 제공되는 서비스는 &ldquo;slack_token_path&rdquo; 라는 이름의 환경 변수를 읽어 파일 경로를 구할 수 있습니다. 이 경로를 통해서 token 정보를 알아냅니다. 그리고 구해진 token 정보를 이용해서 slack이 제공하는 기능을 이용할 수 있습니다.</p>
<p>이렇게 container에서 token 정보를 구할 수 있도록 하기 위해서, Deployment의 yaml 파일에서 container가 사용할 환경 변수를 등록할 수 있는 &ldquo;env&quot;를 이용해서 &ldquo;slack_token_path&quot;를 등록합니다. 이 환경 변수(slack_token_path)는 token 정보가 존재하는 &ldquo;경로와 파일명&quot;의 조합입니다.</p>
<p>이 경로에 해당 파일을 만들기 위해서 volumeMounts를 이용해서 지정된 경로에 volume을 mount 합니다.</p>
<p>이때 사용되어질 &ldquo;secret&rdquo; 타입의 volume은 token 정보를 Pod에서 사용할 수 있도록 하는 &ldquo;Secret&rdquo; 객체입니다.</p>
<p>token은 민감한 정보이기 때문에 별도의 과정을 통해서 전달되어 진다고 상상해 볼 수 있습니다. 어떠한 방식으로든지 전달된 token을 이용해서 &ldquo;Secret&quot;을 생성하는 과정을 거칠 수 있습니다.</p>
<p>Secret을 생성하는 인자 중 에 &ldquo;generic&quot;을 사용합니다. generic은 로컬의 파일등을 이용해서 Secret을 만들겠다는 의미로 type에 따라서 Secret을 생성하는 방식을 달리 할 수도 있습니다.</p>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-8444244371421612"
     data-ad-slot="6693872766"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

					</div>
				</article>
        
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
               <span class="posted-on">
                  <time class="entry-date published" datetime="January 11, 2019">January 11, 2019</time>
               </span>
						</div>
						<h1 class="entry-title">
						  <a href="https://shrinklabs.com/post/container_running-mongodb-database-in-kubernetes-with-statefulsets/" rel="bookmark">6.Running Mongodb Database in Kubernetes With Statefulsets</a>
						</h1>
					</header>
					<div class="entry-content">
						<p>지금까지의 과정 중에서 가장 어려웠습니다.;;; 그리고 제대로 이해를 한건지도 잘 모르겠습니다.</p>
<p>일단을 이해했다고 생각되는 정도만 정리를 해봤습니다.</p>
<p>이번 과정은 StatefulSet에 대한 이해를 목표로 하고 있습니다.</p>
<p>StatefulSet에 대한 이해를 위해서는 Headless Service에 대한 이해와 StorageClass에 대한 이해가 필요했습니다.</p>
<p>StorageClass는 상태를 갖는걸 확인하기 위한 실습이 필요하다보니, Volume을 사용해야 하고 StatefulSet의 scale을 조정하게 되는 것에 따라서 Volume도 같이 조정이 되어야 해서 StorageClass 컨트롤러를 통해서 Volume을 동적으로 조정할 수 있도록 하려고 사용 된 것 같습니다.</p>
<p>(StorageClass는 다음에 기회가 되면 다시 좀 알아 봐야 할 것 같습니다.)</p>
<p>StatefulSet의 목적은 기존에 Deployment에서 상태가 없는 Pod들을 관리하기 위한 목적이 포함되어 있었다고 하면, 이 컨트롤러는 상태를 갖는 Pod를 관리하기 위한 목적이라고 이해를 했습니다. 데이터라는 상태를 갖는 mongodb를 실습에서 사용을 한 것 같습니다.</p>
<p>그리고 Deployment같은 컨트롤러의 경우에 Service 컨트롤러를 통해서 노출을 시켜줄 수 있었던 것 처럼 StatefulSet도 Service 컨트롤러를 이용해서 노출을 합니다. 여기에서 StatefulSet은 Headless Service라고 불리는 설정으로 노출이 되게 됩니다. Service를 정의하고 있는 yaml파일을 보시면 “clusterIP: None”으로 지정이 되어 있는걸 볼 수 있습니다. 이는 로드밸런서의 영향을 받지 않는 서비스를 정의할 때 사용한다고 합니다.</p>
<p>StatefulSet 컨트롤러를 통해서 관리되는 Pod는 생성되는 순서도 중요하기 때문에 Pod를 조회해보면 이름이 mongo-0, mongo-1&hellip; 과 같이 순서를 확인할 수 있는 숫자가 붙어 있습니다.</p>
<p>생성되는 순서도 0부터 차례대로 생성이 되고 scale을 통해서 replicas를 조정하면 차례대로 늘어나고 역순으로 줄어드는걸 확인 할 수 있었습니다.</p>
<p>Volume에 대한 이해가 없이 StatefuleSet을 바로 이해를 하려고 한다는게 무리가 있어 보입니다. 그래서 이후에 꼭 Volume에 대한 이해를 해보는 기회를 갖어야 할 것 같습니다.</p>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-8444244371421612"
     data-ad-slot="6693872766"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

					</div>
				</article>
        
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
               <span class="posted-on">
                  <time class="entry-date published" datetime="January 10, 2019">January 10, 2019</time>
               </span>
						</div>
						<h1 class="entry-title">
						  <a href="https://shrinklabs.com/post/container_continuous-delivery-with-jenkins-in-kubernetes-engine/" rel="bookmark">5.Continuous Delivery With Jenkins in Kubernetes Engine</a>
						</h1>
					</header>
					<div class="entry-content">
						<p>이번 과정은 Jenkins와 Kubernetes를 이용한 배포 자동화를 실습해 볼 수 있었습니다.</p>
<p>분량은 많지만 이해가 어렵지는 않은 내용이었습니다.</p>
<p>실습을 해보면서 Namespace라는 객체와 Helm이라는 패키지 관리 도구를 사용해 볼 수 있습니다. Namespace는 일반적으로 우리가 알고 있는 용도인데, 논리적으로 무언가를 구분지어서 사용하고 싶을때 사용하는게 목적이라고 보면 될 것 같습니다.</p>
<p>이전 과정에서 배웠던 배포를 위한 전략에서는 label을 사용했었다면, 이번에는 Namespace를 사용해서 비슷한 문제 상황을 해결하는걸 경험해 볼 수 있습니다.</p>
<p>그리고 helm은 Kubernetes의 클러스터에 올라갈 수 있도록 미리 정의해서 배포해 놓은걸 사용할 수 있게 해주는 도구였습니다. 이번 실습 과정 중에는 Jenkins를 helm을 이용해서 설치를 했습니다.</p>
<p>(뒤에 있는 과정 중에서 helm을 좀 더 자세하게 다루는것 같으니 여기서는 이렇다는 정도만 확인하고 넘어가도 될 것 같습니다.)</p>
<p>이제 Jenkins를 통해서 배포가 자동화 되는 시나리오를 학습해 보기 위해서 서비스가 제공되는 과정을 만들어 놓습니다.</p>
<p>실제 서비스와 Canary 배포를 위한 Namespace를 &ldquo;production&rdquo;, &ldquo;canary&quot;로 만들어서 배포를 하고 Service를 적용해 놓았습니다.</p>
<p>그리고 Jenkins에서 Pipeline을 만들어 놓습니다.</p>
<p>이 과정중에서 가장 중요한건 &ldquo;Scan Multibranch Pipeline Trigger&quot;가 아닐까 싶습니다.</p>
<p>이 설정으로 인해서 지정한 git 경로의 branch들에 변화가 생기는걸 지속적으로 확인하고 변화가 있을때 배포 작업을 시작합니다. branch에 변화가 생긴걸 확인하게 되면 build 및 기타등등의 Jenkins가 목적으로 하는 작업들을 수행 후, Jenkins에서 Kubernetes의 클러스터에 해당하는 branch 명으로 Namespace를 만들어서 배포하게 됩니다.</p>
<p>개발하는데 사용이 되었던 branch가 &ldquo;new-feature&quot;라면 &ldquo;new-feature&quot;라는 이름의 Namespace가 생성되고 해당 Namespace에 배포를 하게 됩니다. Canary 배포를 하고자 한다면, branch를 &ldquo;canary&quot;로 만들어서 배포를 하면 됩니다. 그리고 master branch의 경우에는 Jenkinsfile에 보면, master branch의 경우 &ldquo;production&rdquo; Namespace를 이용하도록 지정되어 있습니다.</p>
<p>이번 과정에서는 Namespace를 활용하면, 하나의 Kubernetes 클러스터 상에서도 각자 목적이 다른 솔루션들이 영역 구분을 하고 배치해도 흐름이 끊기지 않고 계속해서 작업이 이어지도록 할 수 있다는걸 학습했습니다.</p>
<p>각 객체들(Deployment, Service, Namespace &hellip;)의 정의와 특성 그리고 한계점에 대해서 명확하게 파악해 놓으면 필요한 상황별로 설계를 하는데 도움이 많이 될 것 같습니다.</p>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-8444244371421612"
     data-ad-slot="6693872766"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

					</div>
				</article>
        
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
               <span class="posted-on">
                  <time class="entry-date published" datetime="January 9, 2019">January 9, 2019</time>
               </span>
						</div>
						<h1 class="entry-title">
						  <a href="https://shrinklabs.com/post/container_managing-deployments-using-kubernetes/" rel="bookmark">4.Managing Deployments Using Kubernetes</a>
						</h1>
					</header>
					<div class="entry-content">
						<p>이번 장에서는 &ldquo;Deployment&quot;가 어떤 역할을 할 수 있으며, 이를 이용해서 취할 수 있는 배포 전략에 대해서 알아볼 수 있었습니다.</p>
<p>(이번 장에서 실습을 위해서는 필수적으로 compute/zone 설정을 us-central1-a로 지정해 놓아야 cluster 생성을 정상적으로 할 수 있습니다.)</p>
<p>Deployment 뿐만이 아니라 다른 객체들을 사용하기 위해서도 yaml을 작성할때 각 필드에 대한 정보를 어디에서 확인해야 하는지가 궁금했습니다.</p>
<pre><code>$ kubectl explain deployment

$ kubectl explain --recursive

$ kubectl explain deployment.metadata.name
</code></pre><p>등과 같이 확인을 할 수 있습니다.</p>
<p>Deployment는 ReplicaSet으로 Pod를 관리할 수 있도록 합니다. 그래서 &ldquo;replicas&quot;를 조정해서 서비스를 확장하거나 축소할 수 있습니다.</p>
<p>Deployment가 수정되면 Rolling 업데이트 방식으로 기존의 Pod가 줄어들면서 새로운 Deployment가 적용된 Pod가 늘어나는 방식으로 교체가 됩니다.</p>
<p>ReplicaSet을 조회해보고  rollout의 history를 조회해서 업데이트의 상태를 확인해 볼 수 있었습니다. 이렇게 Deployment가 적용되는 방식에 대해서는 &ldquo;rollout&quot;의 pause, status, resume, undo 등으로 상태등을 조정할 수 도 있었습니다.</p>
<p>배포를 관리하는 방식으로 Canary, Blue-Green 과 같은 방식들이 있습니다.</p>
<p>처음에 Canary 배포에 대한 부분은 실습을 하다만 느낌이 들었는데, 그런 느낌은 Canary 배포의 목적에 대해서 알지 못 해서 그랬던것 같습니다.</p>
<p>실제 배포를 하기 전에 서비스의 실사용 환경에서 제한된 사용자를 선택해서 테스트 해보기 위한 정도라고 생각을 하고 실습을 다시 해보니 괜찮은 방법 같아 보였습니다. 실 서비스로 사용되어지는 Deployment와 배포되기 전에 확인을 위해서 사용되어질 Deployment(Canary)를 구분 지었을때, 문제가 발생하거나 하면 Deployment(Canary)만 조정을 하면 되니 신속한 관리가 가능할것 같았습니다.</p>
<p>Blue-Green 전략은 두 개의 Deployment(Blue/Green)를 적용해 놓고 Service를 원하는 Deployment에 적용시켜 놓는 방식으로 클러스터의 자원을 충분히 확보할 수 있을때 사용하면 좋은 전략인것 같습니다.</p>
<p>배포를 위한 전략들을 하나씩 실습해보면서 Deployment, Service 등의 각 객체의 특성을 잘 파악하고 있어야만, 어떻게 배치 할 수 있는지 그리고 어떤 식으로 운영할지에 대해서 계획 세울수 있겠다 싶었습니다.</p>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-8444244371421612"
     data-ad-slot="6693872766"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

					</div>
				</article>
        
			</div>
		</div>

		<center class="">
			<ul class="pagination">
        
<ul class="pagination">
  <li class="page-item">
    <a href="/post/" class="page-link" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
  </li>
  <li class="page-item">
    <a href="/post/" class="page-link" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
  </li>
  <li class="page-item">
    <a class="page-link" href="/post/">1</a>
  </li>
  <li class="page-item active">
    <a class="page-link" href="/post/page/2/">2</a>
  </li>
  <li class="page-item">
    <a class="page-link" href="/post/page/3/">3</a>
  </li>
  <li class="page-item disabled">
    <span aria-hidden="true">&nbsp;&hellip;&nbsp;</span>
  </li>
  <li class="page-item">
    <a class="page-link" href="/post/page/6/">6</a>
  </li>
  <li class="page-item">
    <a href="/post/page/3/" class="page-link" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
  </li>
  <li class="page-item">
    <a href="/post/page/6/" class="page-link" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
  </li>
</ul>


			</ul>
		</center>
	</div>	

</main>

    
    
      <footer id="footer">
	<div class="container">
		<div class="row">
			

			
			<div class="col-md-3 widget">
				<h3 class="widget-title">Follow me</h3>
				<div class="widget-body">
					<p class="follow-me-icons">
            
							
								<a href="https://www.facebook.com/jaehoon" target="_blank"><i class="fab fa-facebook-square fa-1x"></i></a>
							
            
							
								<a href="https://twitter.com/jaehoonn_" target="_blank"><i class="fab fa-twitter-square fa-1x"></i></a>
							
            
							
								<a href="https://github.com/jaehoonn" target="_blank"><i class="fab fa-github fa-1x"></i></a>
							
            
							
								<a href="mailto:jaehoon@shrinklabs.com" target="_blank"><i class="fas fa-envelope-square fa-1x"></i></a>
							
            
					</p>
				</div>
			</div>
			

			

			

		</div> 
	</div>
</footer>

<footer id="underfooter">
	<div class="container">
		<div class="row">

			<div class="col-md-6 widget">
				<div class="widget-body">
					<p></p>
				</div>
			</div>

			<div class="col-md-6 widget">
				<div class="widget-body">
					<p class="text-right">
						Copyright &copy; 2021, <br>
						Design: <a href="http://www.gettemplate.com" rel="designer">Initio by GetTemplate</a> - 
						Powered by: <a href="https://gohugo.io/" rel="poweredby">Hugo</a>
					</p>
				</div>
			</div>

		</div> 
	</div>
</footer>




<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>




<script src="https://shrinklabs.com/js/bundle.min.f4a965ad0a8118e32f8f0f158ff3aadbacf700934c22286a1a5b245105e9006da73a873b001a160db22498909c1df14d1f835dba5ad76f80b32b0234182b2a58.js" integrity="sha512-9KllrQqBGOMvjw8Vj/Oq26z3AJNMIihqGlskUQXpAG2nOoc7ABoWDbIkmJCcHfFNH4NdulrXb4CzKwI0GCsqWA=="></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'G-4LRCTZDF74', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>

    
  </body>
  
</html>