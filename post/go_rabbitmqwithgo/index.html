<!DOCTYPE html>
<html lang="en">
    <head>
		
		
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>RabbitMQ 스터디(with go) &middot; ShrinkLabs</title>

		
  		<link rel="stylesheet" href="/css/style.css">
		<link rel="stylesheet" href="/css/fonts.css">
		
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

		
		<link href="" rel="alternate" type="application/rss+xml" title="ShrinkLabs" />
	</head>

    <body>
        		<nav class="nav">
			<div class="nav-container">
				<a href="/">
					<h2 class="nav-title">ShrinkLabs</h2>
				</a>
				<ul>
    
    
        <li>
            <a href="/about/">
                
                <span>about</span>
                
            </a>
        </li>
    
</ul>
			</div>
		</nav>

        

<main>
	<div class="post">
		<div class="post-info">
    <span>Written by</span>
        
        <br>
        <span>on&nbsp;</span><time datetime="2017-04-19 23:43:52 &#43;0900 KST">April 19, 2017</time>
</div>

		<h1 class="post-title">RabbitMQ 스터디(with go)</h1>
<div class="post-line"></div>

		

		<p>Go언어로  RabbitMQ를 어떻게 이용할 수 있는지 스터디하는 내용들을 대충 대충  정리하는 중&hellip;</p>
<h2 id="rabbitmq라는게-뭐지">RabbitMQ라는게 뭐지?</h2>
<p>AMQP를 구현한 메세지 브로커<br>
여기 저기에 있는 클라이언트들(Producer/Consumer)이 메세지를 서로 주고 받을 수 있도록 해주는 그런거?</p>
<h2 id="설치">설치</h2>
<ul>
<li>RabbitMQ 설치</li>
</ul>
<pre><code>sudo apt-get install rabbitmq-server
</code></pre><ul>
<li>관리 플러그인 설치</li>
</ul>
<pre><code>sudo rabbitmq-plugins enable rabbitmq_management   
sudo service rabbitmq-server restart
</code></pre><ul>
<li>실행</li>
</ul>
<pre><code>service rabbitmq-server start
</code></pre><ul>
<li>계정 등록(id:jaehoonn, pw:1234)</li>
</ul>
<pre><code>rabbimqctl add_user jaehoonn 1234
</code></pre><ul>
<li>등록한 계정을 관리자 계정으로 변경</li>
</ul>
<pre><code>rabbitmqctl set_user_tags jaehoonn administrator
</code></pre><ul>
<li>웹브라우저로 관리 플러그인에 접속</li>
</ul>
<pre><code>localhost:15672  
</code></pre><h2 id="용어">용어</h2>
<p>대충 요런것들에 대해서 찾아 보면 될 것 같은데&hellip;</p>
<ul>
<li>브로커(broker): 미들웨어, 메세지를 받고 전달</li>
<li>가상호스트(virtual host): 가상 영역</li>
<li>연결(connection): 물리적인 네트워크 연결(?)</li>
<li>채널(channel): 논리적인 네트워크 연결(?)</li>
<li>익스체인지(exchange): 생산된 새로운 메세지를 큐에 전달</li>
<li>큐(queue): RabbitMQ 에 존재하는 우편함으로 메세지를 저장</li>
<li>결합(binding): 익스체인지와 큐를 연결</li>
<li>큐(queue)의 속성</li>
<li>durable: 브로커가 재시작되어도 큐를 선언한 상태로 유지 여부</li>
<li>autoDelete: 큐에서 소비할 대상이 없을때 큐의 유지 여부</li>
<li>exclusive: 다른 연결에서 큐를 사용 가능 여부</li>
<li>arguments: 사용자 정의 큐를 설정</li>
</ul>
<h2 id="go언어에서-rabbitmq-사용">Go언어에서 RabbitMQ 사용</h2>
<ul>
<li>패키지는 amqp를 사용 (<a href="https://github.com/streadway/amqp">https://github.com/streadway/amqp</a>)</li>
<li>tutorial(<a href="http://www.rabbitmq.com/getstarted.html">http://www.rabbitmq.com/getstarted.html</a>) 을 보면 6개의 챕터로 나누어져 있으며, 각 챕터마다 Go언어를 사용한 내용이 존재 합니다.</li>
<li>tutorial의 예제 코드는 github(<a href="https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/go">https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/go</a>) 에서 확인 할 수 있습니다.</li>
</ul>
<h2 id="amqp-패키지">amqp 패키지</h2>
<ul>
<li>
<p>Type은 다음과 같은 것들이 있습니다.</p>
<ul>
<li>Acknowledger</li>
<li>Authentication</li>
<li>Blocking</li>
<li>Channel</li>
<li>Config</li>
<li>Configuration</li>
<li>Connection</li>
<li>Decimal</li>
<li>Delivery</li>
<li>Error</li>
<li>PlainAuth</li>
<li>Publishing</li>
<li>Queue</li>
<li>Return</li>
<li>Table</li>
<li>URI</li>
</ul>
</li>
<li>
<p>여기에서 Acknowledger와 Authentication은 인터페이스 이므로 패스,<br>
패키지 내부에서 사용하는 타입(?)들인 Blocking, Configuration, Decimal, Error, Publishing, Queue, Table도 패스<br>
Config, URI, Delivery는 DialXXX, Open 함수, Connection, Channel 타입에서 사용하는 용도이므로 대충 이런거구나 하고 패스<br>
Connection, Channel 타입에 대해서만 좀 알아 보면 좋을것 같습니다.</p>
</li>
<li>
<p>Connection의 메소드들에 대해서 알아보겠습니다</p>
<ul>
<li>Channel()</li>
<li>Close()</li>
<li>ConnectionState()</li>
<li>LocalAddr()</li>
<li>Notify(Blocked, Close)</li>
</ul>
</li>
<li>
<p>Channel의 메소드들에 대해서 알아보겠습니다</p>
<ul>
<li>Acknowledger 인터페이스의 구현 메소드<br>
Ack(), Nack(), Reject()</li>
<li>Channel 기능에 대한 메소드 나열<br>
Cancel(), Close(), Confirm(), Consume(), Flow(), Get(), Publish(), Qos(), Recover()</li>
<li>Exchange, Notify, Queue, Tx 관리 메소드<br>
Exchange(Bind, Declare, DeclarePassive, Delete, Unbind)<br>
Notify(Cancel, Close, Confirm, Flow, Publish, Return)<br>
Queue(Bind, Declare, DeclarePassive, Delete, Inspect, Purge, Unbind)<br>
Tx(, Commit, Rollback)</li>
</ul>
</li>
</ul>
<h2 id="tutorial">tutorial</h2>
<ol>
<li>&ldquo;Hello World&rdquo; (<a href="http://www.rabbitmq.com/tutorials/tutorial-one-go.html">http://www.rabbitmq.com/tutorials/tutorial-one-go.html</a>)</li>
<li>Work Queues (<a href="http://www.rabbitmq.com/tutorials/tutorial-two-go.html">http://www.rabbitmq.com/tutorials/tutorial-two-go.html</a>)</li>
<li>Publish/Subscribe (<a href="http://www.rabbitmq.com/tutorials/tutorial-three-go.html">http://www.rabbitmq.com/tutorials/tutorial-three-go.html</a>)</li>
<li>Routing(<a href="http://www.rabbitmq.com/tutorials/tutorial-four-go.html">http://www.rabbitmq.com/tutorials/tutorial-four-go.html</a>)</li>
<li>Topics(<a href="http://www.rabbitmq.com/tutorials/tutorial-five-go.html">http://www.rabbitmq.com/tutorials/tutorial-five-go.html</a>)</li>
<li>Remote Procedure Call(<a href="http://www.rabbitmq.com/tutorials/tutorial-six-go.html">http://www.rabbitmq.com/tutorials/tutorial-six-go.html</a>)</li>
</ol>
<h2 id="hello-world">&ldquo;Hello World&rdquo;</h2>
<ul>
<li>응용프로그램에서 RabbitMQ로 전달되는 메세지는 큐에 저장됩니다.</li>
<li>여러개의 Porducer에서 메세지를 큐에 전달을 하며, 여러개의 Consumer에서 데이터를 수신하려고 시도할 수 있습니다.</li>
<li>RaabbitMQ 클라이언트 라이브러리를 설치</li>
</ul>
<pre><code>go get github.com/streadway/amqp
</code></pre><ul>
<li>mq 서버에 연결</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">amqp</span>.<span style="color:#a6e22e">Dial</span>(<span style="color:#e6db74">&#34;amqp://jaehoonn:1234@localhost:5672&#34;</span>)  
</code></pre></div><p>연결 포트는 5672번을 사용 (관리 플러그인은 15672번 포트를 사용)</p>
<ul>
<li>Connection<br>
Dial(&hellip;) 에서 Connection 타입을 만듭니다.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">ch</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Channel</span>()
</code></pre></div><p>Connection은 소켓 연결 관리, 프로토콜 버전 협상(?), 인증을 처리<br>
Connection을 통해서 Channel을 생성 합니다.</p>
<ul>
<li>Channel<br>
채널을 통해서 큐를 생성</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">q</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ch</span>.<span style="color:#a6e22e">QueueDeclare</span>(<span style="color:#f92672">...</span>)
</code></pre></div><p>큐에 대한 설정을 할 수 있을것 같습니다.<br>
name: 큐의 이름<br>
durable: 브로커 재시작 후에도 큐의 상태를 유지(true)<br>
autoDelete: 소비자가 없으면 유지 되지 않는다(true)<br>
exclusive: 다른 연결에서 큐를 사용하지 못함(true)<br>
noWait: 대기열이 서버에서 선언(true)<br>
args: 사용자 정의 큐를 구성할때 사용<br>
참고) 결합된 큐가 없을때, 목적지 큐를 찾지 못하면 그냥 사라집니다.</p>
<ul>
<li>보내기/받기
<ul>
<li>보내기(Publish)<br>
exchange: exchange 이름<br>
key: routing key의 이름(단일 큐일 경우에는 큐의 이름)<br>
mandatory: 전달할 수 없는 메세지일 경우에 처리<br>
immediate: 전달할 수 없는 메세지일 경우에 처리<br>
msg:</li>
<li>받기(Consume)<br>
queue:<br>
consumer:  <br>
autoAck:   <br>
exclusive: true이면 서버가 메세지의 소비자, false이면 다수의 소비자가 존재<br>
noLocal: 동일한 연결에 대해서 한번 전송한 메세지를 다시 전송하지 않습니다<br>
noWait: 요청이 들어오면 바로 전송합니다.<br>
args:</li>
</ul>
</li>
<li>Work Queues</li>
</ul>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-8444244371421612"
     data-ad-slot="6693872766"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>


		
	</div>

	<div class="pagination">
		<a href="/post/go_multipart-contenttype/" class="left arrow">&#8592;</a>
		<a href="/post/go_build/" class="right arrow">&#8594;</a>

		<a href="#" class="top">Top</a>
	</div>
</main>


        		<footer>
			
			<span>
			&copy; <time datetime="2021-07-22 00:52:41.593445179 &#43;0900 KST m=&#43;0.039976070">2021</time> . Made with <a href='https://gohugo.io'>Hugo</a> using the <a href='https://github.com/EmielH/tale-hugo/'>Tale</a> theme.
			</span>
		</footer>

    </body>
</html>
